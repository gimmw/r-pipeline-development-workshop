<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr Tom Moore - Statistical Scientist">
<meta name="dcterms.date" content="2025-08-01">

<title>Causal Inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="1_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="1_analysis_files/libs/quarto-html/quarto.js"></script>
<script src="1_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="1_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="1_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="1_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="1_analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="1_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="1_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="1_analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="1_analysis_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="1_analysis_files/libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#science-before-statistics" id="toc-science-before-statistics" class="nav-link" data-scroll-target="#science-before-statistics">Science before statistics</a></li>
  <li><a href="#everything-everywhere-all-at-once" id="toc-everything-everywhere-all-at-once" class="nav-link" data-scroll-target="#everything-everywhere-all-at-once">Everything, everywhere, all at once</a></li>
  <li><a href="#genralised-linear-madness" id="toc-genralised-linear-madness" class="nav-link" data-scroll-target="#genralised-linear-madness">Genralised linear madness</a>
  <ul>
  <li><a href="#data-and-methods" id="toc-data-and-methods" class="nav-link" data-scroll-target="#data-and-methods">Data and Methods</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a>
  <ul>
  <li><a href="#food-for-thought" id="toc-food-for-thought" class="nav-link" data-scroll-target="#food-for-thought">Food for thought:</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#beyond-brms-in-space" id="toc-beyond-brms-in-space" class="nav-link" data-scroll-target="#beyond-brms-in-space">Beyond brms: in space</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Causal Inference</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Bayes tools</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr Tom Moore - Statistical Scientist </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 1, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<ul>
<li><p>Without consideration of the causal structure underlying data, it is easy to draw incorrect conclusions.</p></li>
<li><p>Below is a simple example using a simulated dataset with four variables (Y, X, A, B).</p></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled" title="Simulated data">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Simulated data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["a"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["x"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["y"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["b"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"15.483834","2":"72.39192","3":"-93.53289","4":"342.3210"},{"1":"7.741207","2":"40.91659","3":"-49.59872","4":"179.9436"},{"1":"11.452514","2":"55.17052","3":"-72.64158","4":"260.1313"},{"1":"12.531450","2":"57.86717","3":"-76.60300","4":"272.9163"},{"1":"11.617073","2":"51.82960","3":"-65.91515","4":"242.0443"},{"1":"9.575502","2":"45.27684","3":"-53.70590","4":"198.4744"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>Figure 1:</strong> DAG of the simulated data that shows the relationships (arrows) between the outcome (Y), treatment (X), and other measured variables (A + B). The numbers on the arrows represent the known magnitude and direction of relationships with Y.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Under the hood">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Under the hood
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-3-4.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-3-5.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-3-6.png" class="img-fluid"></p>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="science-before-statistics" class="level1">
<h1>Science before statistics</h1>
<ul>
<li>Most approaches fail to recover the simulated value of -1.70.</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Models</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Output</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Validation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false" href="">Coefficients</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false" href="">Stan code</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>fit_brm <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, model_name) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(formula,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> sim_dat,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">here</span>(<span class="st">"Analysis/Models/"</span>, model_name)),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">threads =</span> <span class="fu">threading</span>(<span class="dv">3</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">silent =</span> <span class="dv">0</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Models</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>mod_1 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(y <span class="sc">~</span> x, <span class="st">"mod_1"</span>)         <span class="co"># Univariate</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>mod_2 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(y <span class="sc">~</span> a, <span class="st">"mod_2"</span>)         <span class="co"># Univariate</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>mod_3 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(y <span class="sc">~</span> b, <span class="st">"mod_3"</span>)         <span class="co"># Univariate</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>mod_4 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(y <span class="sc">~</span> x <span class="sc">+</span> a <span class="sc">+</span> b, <span class="st">"mod_4"</span>) <span class="co"># Casual Salad</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>mod_5 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(y <span class="sc">~</span> x <span class="sc">+</span> a, <span class="st">"mod_5"</span>)     <span class="co"># Confounder</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>mod_6 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(y <span class="sc">~</span> x <span class="sc">+</span> b, <span class="st">"mod_6"</span>)     <span class="co"># Collider</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: y ~ x 
   Data: sim_dat (Number of observations: 1000) 
  Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
         total post-warmup draws = 8000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     8.78      0.24     8.32     9.24 1.00     8570     6216
x            -1.40      0.00    -1.41    -1.39 1.00     8980     6141

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     2.15      0.05     2.06     2.25 1.00     8075     5450

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: y ~ a 
   Data: sim_dat (Number of observations: 1000) 
  Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
         total post-warmup draws = 8000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept    -8.20      0.33    -8.86    -7.56 1.00     7597     6147
a            -5.04      0.03    -5.10    -4.98 1.00     7606     6462

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     3.97      0.09     3.80     4.15 1.00     8528     6338

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: y ~ b 
   Data: sim_dat (Number of observations: 1000) 
  Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
         total post-warmup draws = 8000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.24      0.11     0.02     0.46 1.00     8126     6167
b            -0.27      0.00    -0.27    -0.27 1.00    10143     6244

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     1.16      0.03     1.11     1.21 1.00     4012     3903

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: y ~ x + a + b 
   Data: sim_dat (Number of observations: 1000) 
  Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
         total post-warmup draws = 8000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept    -4.03      0.32    -4.65    -3.40 1.00     3138     4273
x             0.71      0.04     0.63     0.79 1.00     3070     3834
a             0.15      0.06     0.04     0.26 1.00     4102     5140
b            -0.42      0.01    -0.43    -0.40 1.00     3635     4377

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.92      0.02     0.88     0.96 1.00     5725     4395

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: y ~ x + a 
   Data: sim_dat (Number of observations: 1000) 
  Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
         total post-warmup draws = 8000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept    12.32      0.43    11.47    13.16 1.00     3341     4050
x            -1.72      0.03    -1.78    -1.65 1.00     2829     3080
a             1.15      0.12     0.92     1.39 1.00     2819     3058

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     2.06      0.05     1.97     2.16 1.00     4982     4378

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: y ~ x + b 
   Data: sim_dat (Number of observations: 1000) 
  Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
         total post-warmup draws = 8000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept    -4.68      0.22    -5.11    -4.24 1.00     3438     4593
x             0.78      0.03     0.72     0.84 1.00     3175     3946
b            -0.42      0.01    -0.43    -0.41 1.00     3181     3901

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.93      0.02     0.89     0.97 1.00     4964     4359

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/validation-1.png" class="img-fluid" width="384"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/validation-2.png" class="img-fluid" width="384"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/validation-3.png" class="img-fluid" width="384"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/validation-4.png" class="img-fluid" width="384"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/validation-5.png" class="img-fluid" width="384"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/validation-6.png" class="img-fluid" width="384"></p>
</div>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "mod_1: -1.4"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "mod_2: -5.04"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "mod_3: -0.27"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "mod_4:  0.71, 0.15, -0.42"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "mod_5: -1.72"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "mod_6: 0.78"</code></pre>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Example Stan code for mod_1"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>// generated with brms 2.22.0
functions {
}
data {
  int&lt;lower=1&gt; N;  // total number of observations
  vector[N] Y;  // response variable
  int&lt;lower=1&gt; K;  // number of population-level effects
  matrix[N, K] X;  // population-level design matrix
  int&lt;lower=1&gt; Kc;  // number of population-level effects after centering
  int prior_only;  // should the likelihood be ignored?
}
transformed data {
  matrix[N, Kc] Xc;  // centered version of X without an intercept
  vector[Kc] means_X;  // column means of X before centering
  for (i in 2:K) {
    means_X[i - 1] = mean(X[, i]);
    Xc[, i - 1] = X[, i] - means_X[i - 1];
  }
}
parameters {
  vector[Kc] b;  // regression coefficients
  real Intercept;  // temporary intercept for centered predictors
  real&lt;lower=0&gt; sigma;  // dispersion parameter
}
transformed parameters {
  real lprior = 0;  // prior contributions to the log posterior
  lprior += student_t_lpdf(Intercept | 3, -58.4, 20);
  lprior += student_t_lpdf(sigma | 3, 0, 20)
    - 1 * student_t_lccdf(0 | 3, 0, 20);
}
model {
  // likelihood including constants
  if (!prior_only) {
    target += normal_id_glm_lpdf(Y | Xc, Intercept, b, sigma);
  }
  // priors including constants
  target += lprior;
}
generated quantities {
  // actual population-level intercept
  real b_Intercept = Intercept - dot_product(means_X, b);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-4-4.png" class="img-fluid"></p>
</div>
</div>
</div>
<p><strong>Figure 2:</strong> Various regression approaches to estimate the Y ~ X relationship (simulated value -1.71). Coefficients on arrows represent the estimated magnitude and direction of relationships. Conditioning on the confounder (A) returns the simulated value.</p>
</section>
<section id="everything-everywhere-all-at-once" class="level1">
<h1>Everything, everywhere, all at once</h1>
<ul>
<li>Modeled as a series of structural equations that represent the data generating process.</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Models</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Output</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Validation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false" href="">Coefficients</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false" href="">Stan code</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>se_1 <span class="ot">&lt;-</span> <span class="fu">bf</span>(x <span class="sc">~</span> a,     <span class="at">family =</span> gaussian)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>se_2 <span class="ot">&lt;-</span> <span class="fu">bf</span>(y <span class="sc">~</span> x <span class="sc">+</span> a, <span class="at">family =</span> gaussian)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>se_3 <span class="ot">&lt;-</span> <span class="fu">bf</span>(b <span class="sc">~</span> x <span class="sc">+</span> y, <span class="at">family =</span> gaussian)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>mod_7 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(se_1 <span class="sc">+</span> se_2 <span class="sc">+</span> se_3 <span class="sc">+</span> <span class="fu">set_rescor</span>(<span class="cn">FALSE</span>), <span class="st">"mod_7"</span>) <span class="co"># Full Luxury Bayesian Inference</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> Family: MV(gaussian, gaussian, gaussian) 
  Links: mu = identity; sigma = identity
         mu = identity; sigma = identity
         mu = identity; sigma = identity 
Formula: x ~ a 
         y ~ x + a 
         b ~ x + y 
   Data: sim_dat (Number of observations: 1000) 
  Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
         total post-warmup draws = 8000

Regression Coefficients:
            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
x_Intercept    11.94      0.16    11.62    12.27 1.00    11177     5534
y_Intercept    12.32      0.43    11.50    13.15 1.00     6507     5784
b_Intercept   -14.90      0.33   -15.55   -14.25 1.00     7304     6715
x_a             3.60      0.02     3.57     3.64 1.00    11852     5254
y_x            -1.72      0.03    -1.78    -1.66 1.00     6399     5761
y_a             1.15      0.12     0.93     1.39 1.00     6465     5641
b_x             2.46      0.04     2.38     2.54 1.00     6581     5554
b_y            -1.93      0.03    -1.99    -1.88 1.00     6501     5596

Further Distributional Parameters:
        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma_x     1.98      0.04     1.89     2.06 1.00    11588     5687
sigma_y     2.06      0.05     1.97     2.16 1.00    12391     5449
sigma_b     1.98      0.04     1.90     2.07 1.00    12765     5688

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="3">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/validation_2-1.png" class="img-fluid" width="384"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/validation_2-2.png" class="img-fluid" width="384"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/validation_2-3.png" class="img-fluid" width="384"></p>
</div>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div class="cell">
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Estimate"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Est.Error"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["l-95% CI"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["u-95% CI"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Rhat"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Bulk_ESS"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Tail_ESS"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"11.941566","2":"0.16427945","3":"11.6190900","4":"12.267412","5":"1.000503","6":"11176.576","7":"5533.619","_rn_":"x_Intercept"},{"1":"12.318854","2":"0.42500044","3":"11.4977875","4":"13.148660","5":"1.000337","6":"6507.183","7":"5784.378","_rn_":"y_Intercept"},{"1":"-14.898405","2":"0.33399696","3":"-15.5460275","4":"-14.252475","5":"1.001071","6":"7304.193","7":"6714.671","_rn_":"b_Intercept"},{"1":"3.604818","2":"0.01547007","3":"3.5742700","4":"3.635172","5":"1.000459","6":"11851.957","7":"5253.892","_rn_":"x_a"},{"1":"-1.718194","2":"0.03241209","3":"-1.7819045","4":"-1.655407","5":"1.000254","6":"6399.394","7":"5761.419","_rn_":"y_x"},{"1":"1.154741","2":"0.11782460","3":"0.9270995","4":"1.387789","5":"1.000202","6":"6464.990","7":"5641.095","_rn_":"y_a"},{"1":"2.456469","2":"0.04152228","3":"2.3753800","4":"2.538481","5":"1.001028","6":"6580.521","7":"5554.106","_rn_":"b_x"},{"1":"-1.933204","2":"0.02941317","3":"-1.9907715","4":"-1.875850","5":"1.000845","6":"6500.644","7":"5596.162","_rn_":"b_y"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>// generated with brms 2.22.0
functions {
}
data {
  int&lt;lower=1&gt; N;  // total number of observations
  int&lt;lower=1&gt; N_x;  // number of observations
  vector[N_x] Y_x;  // response variable
  int&lt;lower=1&gt; K_x;  // number of population-level effects
  matrix[N_x, K_x] X_x;  // population-level design matrix
  int&lt;lower=1&gt; Kc_x;  // number of population-level effects after centering
  int&lt;lower=1&gt; N_y;  // number of observations
  vector[N_y] Y_y;  // response variable
  int&lt;lower=1&gt; K_y;  // number of population-level effects
  matrix[N_y, K_y] X_y;  // population-level design matrix
  int&lt;lower=1&gt; Kc_y;  // number of population-level effects after centering
  int&lt;lower=1&gt; N_b;  // number of observations
  vector[N_b] Y_b;  // response variable
  int&lt;lower=1&gt; K_b;  // number of population-level effects
  matrix[N_b, K_b] X_b;  // population-level design matrix
  int&lt;lower=1&gt; Kc_b;  // number of population-level effects after centering
  int prior_only;  // should the likelihood be ignored?
}
transformed data {
  matrix[N_x, Kc_x] Xc_x;  // centered version of X_x without an intercept
  vector[Kc_x] means_X_x;  // column means of X_x before centering
  matrix[N_y, Kc_y] Xc_y;  // centered version of X_y without an intercept
  vector[Kc_y] means_X_y;  // column means of X_y before centering
  matrix[N_b, Kc_b] Xc_b;  // centered version of X_b without an intercept
  vector[Kc_b] means_X_b;  // column means of X_b before centering
  for (i in 2:K_x) {
    means_X_x[i - 1] = mean(X_x[, i]);
    Xc_x[, i - 1] = X_x[, i] - means_X_x[i - 1];
  }
  for (i in 2:K_y) {
    means_X_y[i - 1] = mean(X_y[, i]);
    Xc_y[, i - 1] = X_y[, i] - means_X_y[i - 1];
  }
  for (i in 2:K_b) {
    means_X_b[i - 1] = mean(X_b[, i]);
    Xc_b[, i - 1] = X_b[, i] - means_X_b[i - 1];
  }
}
parameters {
  vector[Kc_x] b_x;  // regression coefficients
  real Intercept_x;  // temporary intercept for centered predictors
  real&lt;lower=0&gt; sigma_x;  // dispersion parameter
  vector[Kc_y] b_y;  // regression coefficients
  real Intercept_y;  // temporary intercept for centered predictors
  real&lt;lower=0&gt; sigma_y;  // dispersion parameter
  vector[Kc_b] b_b;  // regression coefficients
  real Intercept_b;  // temporary intercept for centered predictors
  real&lt;lower=0&gt; sigma_b;  // dispersion parameter
}
transformed parameters {
  real lprior = 0;  // prior contributions to the log posterior
  lprior += student_t_lpdf(Intercept_x | 3, 47.9, 14.5);
  lprior += student_t_lpdf(sigma_x | 3, 0, 14.5)
    - 1 * student_t_lccdf(0 | 3, 0, 14.5);
  lprior += student_t_lpdf(Intercept_y | 3, -58.4, 20);
  lprior += student_t_lpdf(sigma_y | 3, 0, 20)
    - 1 * student_t_lccdf(0 | 3, 0, 20);
  lprior += student_t_lpdf(Intercept_b | 3, 215.6, 74.1);
  lprior += student_t_lpdf(sigma_b | 3, 0, 74.1)
    - 1 * student_t_lccdf(0 | 3, 0, 74.1);
}
model {
  // likelihood including constants
  if (!prior_only) {
    target += normal_id_glm_lpdf(Y_x | Xc_x, Intercept_x, b_x, sigma_x);
    target += normal_id_glm_lpdf(Y_y | Xc_y, Intercept_y, b_y, sigma_y);
    target += normal_id_glm_lpdf(Y_b | Xc_b, Intercept_b, b_b, sigma_b);
  }
  // priors including constants
  target += lprior;
}
generated quantities {
  // actual population-level intercept
  real b_x_Intercept = Intercept_x - dot_product(means_X_x, b_x);
  // actual population-level intercept
  real b_y_Intercept = Intercept_y - dot_product(means_X_y, b_y);
  // actual population-level intercept
  real b_b_Intercept = Intercept_b - dot_product(means_X_b, b_b);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="genralised-linear-madness" class="level1">
<h1>Genralised linear madness</h1>
<p>This analysis demonstrates science before statistics by incorporating prior knowledge in the modeling approach. Scientific phenomena are often modeled as linear relationships (i.e., generalized linear (mixed) models), which may not capture the data generating process.</p>
<p>Fitting non-linear models such as logarithmic, polynomial curves, or splines may give us a good prediction of relationships, but doesn’t allow us to estimate parameters of interest (e.g., maximum value or growth rate).</p>
<section id="data-and-methods" class="level2">
<h2 class="anchored" data-anchor-id="data-and-methods">Data and Methods</h2>
<p>During my PhD, I measured the length and weight of ~3000 freshwater mussels (yes I’m that exciting!). I want to describe the relationship between length and weight between mussels collected inside macrophyte beds (aquatic plant beds: treatment) vs not (control) based on how the data was generated.</p>
<p>Although the length-weight relationship isn’t technically a temporal relationship (even I’m not going to measure ~3000 mussels repeatedly over time), substituting time for space (length) will allow us to fit a models that estimate the: a) maximum weight; and b) growth rate.</p>
<p>To examine the relationship between the length and weight of freshwater mussels, generalized (non-)linear models were performed in R (R Core Team 2022) using the brms package (Bürkner, 2017). Linear, Gompertz (modified), and Logistic models were fitted with treatment (none vs macrophyte) as a predictor variable. A Gamma distribution was selected for the response since weight has positive and continuous values. Models were compared using leave-one-out cross validation and model validation was performed using prior and posterior predictive checks, as well as effective samples sizes and r-hats (McElreath, 2020).</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Data">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Length"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Height"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Width"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Weight"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Treatment"],"name":[5],"type":["chr"],"align":["left"]},{"label":["Macrophyte"],"name":[6],"type":["chr"],"align":["left"]},{"label":["Site"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"61.0","2":"14.0","3":"40.0","4":"18.7","5":"None","6":"None","7":"Keeleys_Landing"},{"1":"71.0","2":"19.5","3":"42.5","4":"34.0","5":"None","6":"None","7":"Keeleys_Landing"},{"1":"68.0","2":"20.0","3":"44.5","4":"33.7","5":"None","6":"None","7":"Keeleys_Landing"},{"1":"68.5","2":"22.5","3":"40.0","4":"38.7","5":"None","6":"None","7":"Keeleys_Landing"},{"1":"65.5","2":"24.5","3":"42.0","4":"32.7","5":"None","6":"None","7":"Keeleys_Landing"},{"1":"53.0","2":"14.5","3":"34.0","4":"14.0","5":"Macrophyte","6":"Hornwort","7":"Keeleys_Landing"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">Prior linear</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Prior Gompertz</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">Prior logistic</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false" href="">Models</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-5" role="tab" aria-controls="tabset-3-5" aria-selected="false" href="">Output</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-6" role="tab" aria-controls="tabset-3-6" aria-selected="false" href="">Validation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-7" role="tab" aria-controls="tabset-3-7" aria-selected="false" href="">Plot linear</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-8" role="tab" aria-controls="tabset-3-8" aria-selected="false" href="">Plot Gompertz</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-9" role="tab" aria-controls="tabset-3-9" aria-selected="false" href="">Plot Logistic</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-10-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-10" role="tab" aria-controls="tabset-3-10" aria-selected="false" href="">Model comparison</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-11-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-11" role="tab" aria-controls="tabset-3-11" aria-selected="false" href="">Stan code</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fit_brm <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, model_name, priors) {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(formula,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> df,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> priors,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">here</span>(<span class="st">"Analysis/Models/"</span>, model_name)),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">threads =</span> <span class="fu">threading</span>(<span class="dv">3</span>),</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">silent =</span> <span class="dv">0</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>mod_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(Weight <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Length <span class="sc">+</span> Treatment)     <span class="co"># Run with Gaussian family </span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="at">class =</span> b, <span class="at">coef =</span> Intercept, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>)),       <span class="co"># Intercept</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="at">coef =</span> TreatmentNone, <span class="fu">normal</span>(<span class="dv">50</span>,<span class="dv">5</span>)),  <span class="co"># Difference between treatments</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">lb =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">ub =</span> <span class="sc">-</span><span class="dv">2</span>)      <span class="co"># Slope </span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>nl_mod_1 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(mod_formula, <span class="st">"NL_mod_1"</span>, priors)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Gompertz</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>mod_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(Weight <span class="sc">~</span> k <span class="sc">*</span> <span class="fu">exp</span>( <span class="sc">-</span><span class="fu">exp</span>( <span class="sc">-</span>(r <span class="sc">*</span> (Length <span class="sc">-</span> delay)))),</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>                  k <span class="sc">+</span> r <span class="sc">+</span> delay <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Treatment,</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nl =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"k"</span>,     <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">50</span>,<span class="dv">20</span>)),  <span class="co"># Max Weight </span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"r"</span>,     <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.05</span>)), <span class="co"># Growth Rate</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"delay"</span>, <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">30</span>,<span class="dv">2</span>))    <span class="co"># Delay across the x-axis </span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>nl_mod_2 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(mod_formula, <span class="st">"NL_mod_2"</span>, priors)</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>mod_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(Weight <span class="sc">~</span> M <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> (M <span class="sc">-</span> mu0) <span class="sc">/</span> mu0 <span class="sc">*</span> <span class="fu">exp</span>( <span class="sc">-</span>b <span class="sc">*</span> Length)),</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>                  mu0 <span class="sc">+</span> b <span class="sc">+</span> M <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Treatment,</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nl =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"mu0"</span>, <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.1</span>)),  <span class="co"># Weight at length zero</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"b"</span>,   <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.1</span>)),  <span class="co"># Growth rate</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"M"</span>,   <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">50</span>,<span class="dv">20</span>))   <span class="co"># Max Weight</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>nl_mod_3 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(mod_formula, <span class="st">"NL_mod_3"</span>, priors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-5-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: Weight ~ 0 + Intercept + Length + Treatment 
   Data: df (Number of observations: 3040) 
  Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
         total post-warmup draws = 8000

Regression Coefficients:
              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept        -2.05      0.05    -2.17    -2.00 1.00     5240     3222
Length           -2.00      0.00    -2.00    -2.00 1.00     5657     3295
TreatmentNone    -2.08      0.08    -2.30    -2.00 1.00     5786     3655

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma   150.56      1.93   146.89   154.35 1.00     8264     5326

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gamma 
  Links: mu = identity; shape = identity 
Formula: Weight ~ k * exp(-exp(-(r * (Length - delay)))) 
         k ~ 0 + Intercept + Treatment
         r ~ 0 + Intercept + Treatment
         delay ~ 0 + Intercept + Treatment
   Data: df (Number of observations: 3040) 
  Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
         total post-warmup draws = 8000

Regression Coefficients:
                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
k_Intercept           114.56      3.13   108.51   120.82 1.00     3019     3777
k_TreatmentNone        18.14      2.18    13.89    22.55 1.00     3354     3439
r_Intercept             0.03      0.00     0.03     0.03 1.00     2969     3562
r_TreatmentNone         0.00      0.00     0.00     0.00 1.00     3540     2543
delay_Intercept        76.22      0.73    74.80    77.66 1.00     2930     3645
delay_TreatmentNone     1.81      0.29     1.22     2.35 1.00     3479     3328

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
shape    28.61      0.76    27.12    30.13 1.00     5630     4339

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gamma 
  Links: mu = identity; shape = identity 
Formula: Weight ~ M/(1 + (M - mu0)/mu0 * exp(-b * Length)) 
         mu0 ~ 0 + Intercept + Treatment
         b ~ 0 + Intercept + Treatment
         M ~ 0 + Intercept + Treatment
   Data: df (Number of observations: 3040) 
  Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
         total post-warmup draws = 8000

Regression Coefficients:
                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
mu0_Intercept         0.09      0.00     0.08     0.10 1.00     3079     3868
mu0_TreatmentNone     0.00      0.00     0.00     0.00 1.00     3748     2257
b_Intercept           0.10      0.00     0.10     0.11 1.00     2830     3600
b_TreatmentNone       0.00      0.00     0.00     0.00 1.00     3169     2882
M_Intercept          48.41      0.91    46.70    50.26 1.00     2937     4018
M_TreatmentNone       3.18      0.90     1.34     4.86 1.00     3695     2615

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
shape    26.07      0.65    24.83    27.36 1.00     6067     5443

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</div>
<div id="tabset-3-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-6-tab">
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/validation_3-1.png" class="img-fluid" width="384"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/validation_3-2.png" class="img-fluid" width="384"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="1_analysis_files/figure-html/validation_3-3.png" class="img-fluid" width="384"></p>
</div>
</div>
</div>
</div>
<div id="tabset-3-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-7-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-8-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-9-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_analysis_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-10" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-10-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Output of model 'nl_mod_1':

Computed from 8000 by 3040 log-likelihood matrix.

         Estimate   SE
elpd_loo -19559.0 11.2
p_loo         0.1  0.0
looic     39117.9 22.5
------
MCSE of elpd_loo is 0.0.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.8, 1.0]).

All Pareto k estimates are good (k &lt; 0.7).
See help('pareto-k-diagnostic') for details.

Output of model 'nl_mod_2':

Computed from 8000 by 3040 log-likelihood matrix.

         Estimate    SE
elpd_loo  -8320.0  76.5
p_loo        16.0   2.3
looic     16640.0 153.0
------
MCSE of elpd_loo is 0.1.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.4, 1.0]).

All Pareto k estimates are good (k &lt; 0.7).
See help('pareto-k-diagnostic') for details.

Output of model 'nl_mod_3':

Computed from 8000 by 3040 log-likelihood matrix.

         Estimate    SE
elpd_loo  -8461.3  89.8
p_loo        16.6   2.2
looic     16922.6 179.6
------
MCSE of elpd_loo is 0.1.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.4, 1.0]).

All Pareto k estimates are good (k &lt; 0.7).
See help('pareto-k-diagnostic') for details.

Model comparisons:
         elpd_diff se_diff 
nl_mod_2      0.0       0.0
nl_mod_3   -141.3      48.3
nl_mod_1 -11238.9      74.1</code></pre>
</div>
</div>
</div>
<div id="tabset-3-11" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-11-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>// generated with brms 2.22.0
functions {
}
data {
  int&lt;lower=1&gt; N;  // total number of observations
  vector[N] Y;  // response variable
  int&lt;lower=1&gt; K_k;  // number of population-level effects
  matrix[N, K_k] X_k;  // population-level design matrix
  int&lt;lower=1&gt; K_r;  // number of population-level effects
  matrix[N, K_r] X_r;  // population-level design matrix
  int&lt;lower=1&gt; K_delay;  // number of population-level effects
  matrix[N, K_delay] X_delay;  // population-level design matrix
  // covariates for non-linear functions
  vector[N] C_1;
  int prior_only;  // should the likelihood be ignored?
}
transformed data {
}
parameters {
  vector&lt;lower=0&gt;[K_k] b_k;  // regression coefficients
  vector&lt;lower=0&gt;[K_r] b_r;  // regression coefficients
  vector&lt;lower=0&gt;[K_delay] b_delay;  // regression coefficients
  real&lt;lower=0&gt; shape;  // shape parameter
}
transformed parameters {
  real lprior = 0;  // prior contributions to the log posterior
  lprior += normal_lpdf(b_k | 50, 20)
    - 2 * normal_lccdf(0 | 50, 20);
  lprior += normal_lpdf(b_r | 0, 0.05)
    - 2 * normal_lccdf(0 | 0, 0.05);
  lprior += normal_lpdf(b_delay | 30, 2)
    - 2 * normal_lccdf(0 | 30, 2);
  lprior += gamma_lpdf(shape | 0.01, 0.01);
}
model {
  // likelihood including constants
  if (!prior_only) {
    // initialize linear predictor term
    vector[N] nlp_k = rep_vector(0.0, N);
    // initialize linear predictor term
    vector[N] nlp_r = rep_vector(0.0, N);
    // initialize linear predictor term
    vector[N] nlp_delay = rep_vector(0.0, N);
    // initialize non-linear predictor term
    vector[N] mu;
    nlp_k += X_k * b_k;
    nlp_r += X_r * b_r;
    nlp_delay += X_delay * b_delay;
    for (n in 1:N) {
      // compute non-linear predictor values
      mu[n] = (nlp_k[n] * exp( - exp( - (nlp_r[n] * (C_1[n] - nlp_delay[n])))));
    }
    target += gamma_lpdf(Y | shape, shape ./ mu);
  }
  // priors including constants
  target += lprior;
}
generated quantities {
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Models can be used to estimate parameters of interest that better capture data generating process based on ecological theory.</p>
<p>Prior information can be useful in constraining models to realistic estimates.</p>
<p>Here the Gompertz and logistic models estimated the growth rate to be 0.03 and 0.10 and maximum weight to be 115 (g) and 50.0 (g), respectively.</p>
<section id="food-for-thought" class="level3">
<h3 class="anchored" data-anchor-id="food-for-thought">Food for thought:</h3>
<p>Which model is the best at capturing the data generating process?</p>
<p>Could ecological theory informed techniques be applied to your own research?</p>
</section>
</section>
</section>
<section id="beyond-brms-in-space" class="level1">
<h1>Beyond brms: in space</h1>
<p>This section demonstrates the use of Stan to fit a choice model based on the hidden minds and observed behavior data example from McElreath (2020). The model estimates the probability of choosing a particular option based on the majority and minority choices, as well as the maverick and random choices.</p>
<p>The five stratergies are:</p>
<ul>
<li>Follow the Majority: Copy the majority demonstrated color.</li>
<li>Follow the Minority: Copy the minority demonstrated color.</li>
<li>Maverick: Choose the color that no demonstrator chose.</li>
<li>Random: Choose a color at random, ignoring the demonstrators.</li>
<li>Follow First: Copy the color that was demonstrated first. This was either the majority color (when majority_first equals 1) or the minority color (when 0). (p.&nbsp;533)</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">Stan - Model</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Output</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false" href="">Plot</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>data{ int N; int y[N]; int majority_first[N]; } parameters{ simplex[5] p; } model{ vector[5] phi;</p>
<pre><code> // prior
 p ~ dirichlet( rep_vector(4,5) );

 // probability of data
 for ( i in 1:N ) {
     if ( y[i]==2 ) phi[1]=1; else phi[1]=0; // majority
     if ( y[i]==3 ) phi[2]=1; else phi[2]=0; // minority
     if ( y[i]==1 ) phi[3]=1; else phi[3]=0; // maverick
     phi[4]=1.0/3.0;                         // random
     if ( majority_first[i]==1 )             // follow first
         if ( y[i]==2 ) phi[5]=1; else phi[5]=0;
     else
         if ( y[i]==3 ) phi[5]=1; else phi[5]=0;

     // compute log( p_s * Pr(y_i|s )
     for ( j in 1:5 ) phi[j] = log(p[j]) + log(phi[j]);
     // compute average log-probability of y_i
     target += log_sum_exp( phi );
}</code></pre>
<p>}</p>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: anon_model.
3 chains, each with iter=2000; warmup=1000; thin=1; 
post-warmup draws per chain=1000, total post-warmup draws=3000.

      mean se_mean    sd  2.5%   25%   50%   75% 97.5% n_eff  Rhat
p[1] 0.258   0.001 0.037 0.183 0.234 0.258 0.283 0.326   695 1.002
p[2] 0.139   0.001 0.033 0.072 0.118 0.140 0.162 0.202   774 1.001
p[3] 0.148   0.001 0.031 0.087 0.127 0.149 0.171 0.204   765 1.002
p[4] 0.195   0.003 0.081 0.059 0.134 0.189 0.250 0.370   582 1.002
p[5] 0.260   0.001 0.032 0.195 0.238 0.260 0.281 0.324  2707 1.000

Samples were drawn using NUTS(diag_e) at Tue Aug 26 12:16:37 2025.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1_analysis_files/figure-html/plot_3-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p>McElreath, R. (2020). Statistical rethinking: A Bayesian course with examples in R and Stan. Chapman and Hall/CRC.</p>
<p>R Core Team (2022). R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. <a href="https://www.R-project.org/" class="uri">https://www.R-project.org/</a></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Session Information">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Session Information
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.1 (2024-06-14)
Platform: x86_64-pc-linux-gnu
Running under: Ubuntu 22.04.5 LTS

Matrix products: default
BLAS/LAPACK: /opt/OpenBLAS-0.3.29/lib/libopenblasp-r0.3.29.so;  LAPACK version 3.12.0

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

time zone: Pacific/Auckland
tzcode source: system (glibc)

attached base packages:
[1] parallel  grid      stats     graphics  grDevices utils     datasets 
[8] methods   base     

other attached packages:
 [1] adegenet_2.1.11        ade4_1.7-23            rethinking_2.42       
 [4] posterior_1.6.1        marginaleffects_0.25.1 graph4lg_1.8.0        
 [7] nadiv_2.18.0           Matrix_1.7-0           cmdstanr_0.9.0.9000   
[10] tidybayes_3.0.7        bayesplot_1.13.0       brms_2.22.0           
[13] Rcpp_1.1.0             Rgraphviz_2.50.0       graph_1.84.1          
[16] BiocGenerics_0.52.0    bnlearn_5.0.2          rstan_2.32.7          
[19] StanHeaders_2.32.10    furrr_0.3.1            future_1.58.0         
[22] simDAG_0.3.0           ggdag_0.2.13           dagitty_0.3-4         
[25] GGally_2.3.0           gplots_3.2.0           ggdendro_0.2.0        
[28] cowplot_1.2.0          ggtext_0.1.2           usethis_3.1.0         
[31] pins_1.4.1             arrow_20.0.0.2         reshape2_1.4.4        
[34] modelr_0.1.11          readxl_1.4.5           janitor_2.2.1         
[37] here_1.0.1             lubridate_1.9.4        forcats_1.0.0         
[40] stringr_1.5.1          dplyr_1.1.4            purrr_1.0.4           
[43] readr_2.1.5            tidyr_1.3.1            tibble_3.2.1          
[46] ggplot2_3.5.2          tidyverse_2.0.0       

loaded via a namespace (and not attached):
  [1] svUnit_1.0.6         later_1.4.2          splines_4.4.1       
  [4] bitops_1.0-9         cellranger_1.1.0     polyclip_1.10-7     
  [7] lifecycle_1.0.4      rprojroot_2.0.4      processx_3.8.6      
 [10] globals_0.18.0       lattice_0.22-6       vroom_1.6.5         
 [13] MASS_7.3-60.2        ggdist_3.3.3         backports_1.5.0     
 [16] magrittr_2.0.3       rmarkdown_2.29       yaml_2.3.10         
 [19] httpuv_1.6.16        pkgbuild_1.4.7       RColorBrewer_1.1-3  
 [22] abind_1.4-8          ggraph_2.2.1         tensorA_0.36.2.1    
 [25] tweenr_2.0.3         ggrepel_0.9.6        inline_0.3.21       
 [28] listenv_0.9.1        vegan_2.6-10         bridgesampling_1.1-2
 [31] parallelly_1.45.0    permute_0.9-7        commonmark_1.9.5    
 [34] codetools_0.2-20     xml2_1.3.8           ggforce_0.4.2       
 [37] tidyselect_1.2.1     shape_1.4.6.1        farver_2.1.2        
 [40] viridis_0.6.5        matrixStats_1.5.0    stats4_4.4.1        
 [43] jsonlite_2.0.0       tidygraph_1.3.1      emmeans_1.11.0      
 [46] tools_4.4.1          pak_0.8.0.2          glue_1.8.0          
 [49] gridExtra_2.3        xfun_0.52            mgcv_1.9-3          
 [52] distributional_0.5.0 loo_2.8.0            withr_3.0.2         
 [55] fastmap_1.2.0        boot_1.3-30          callr_3.7.6         
 [58] litedown_0.7         caTools_1.18.3       digest_0.6.37       
 [61] mime_0.13            timechange_0.3.0     R6_2.6.1            
 [64] estimability_1.5.1   colorspace_2.1-1     gtools_3.9.5        
 [67] markdown_2.0         generics_0.1.4       data.table_1.17.6   
 [70] graphlayouts_1.2.2   htmlwidgets_1.6.4    ggstats_0.9.0       
 [73] pkgconfig_2.0.3      gtable_0.3.6         S7_0.2.0            
 [76] htmltools_0.5.8.1    scales_1.4.0         snakecase_0.11.1    
 [79] knitr_1.50           rstudioapi_0.17.1    tzdb_0.5.0          
 [82] coda_0.19-4.1        checkmate_2.3.2      nlme_3.1-164        
 [85] curl_6.2.2           cachem_1.1.0         KernSmooth_2.23-24  
 [88] pillar_1.11.0        vctrs_0.6.5          promises_1.3.2      
 [91] arrayhelpers_1.1-0   cluster_2.1.6        xtable_1.8-4        
 [94] evaluate_1.0.4       mvtnorm_1.3-3        cli_3.6.5           
 [97] compiler_4.4.1       rlang_1.1.6          crayon_1.5.3        
[100] rstantools_2.4.0     labeling_0.4.3       ps_1.9.1            
[103] plyr_1.8.9           fs_1.6.6             stringi_1.8.7       
[106] viridisLite_0.4.2    QuickJSR_1.7.0       assertthat_0.2.1    
[109] Brobdingnag_1.2-9    V8_6.0.3             hms_1.1.3           
[112] bit64_4.6.0-1        seqinr_4.2-36        shiny_1.10.0        
[115] gridtext_0.1.5       igraph_2.1.4         broom_1.0.8         
[118] memoise_2.0.1        RcppParallel_5.1.10  bit_4.6.0           
[121] ape_5.8-1           </code></pre>
</div>
</div>
<!-- -->

</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb28" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Causal Inference"</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Bayes tools"</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Dr Tom Moore - Statistical Scientist"</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> last-modified</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="an">output-file:</span><span class="co"> "analysis_report.html"</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 5</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "Contents"</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: united</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: tango</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 9</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 6</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: scroll</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: paged</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co">    embeded-resources: true</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: false</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: false</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Install packages and functions</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"pak"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"pak"</span>)</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tidyverse"</span>, <span class="st">"here"</span>, <span class="st">"janitor"</span>, <span class="st">"readxl"</span>, <span class="st">"modelr"</span>,</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"reshape2"</span>, <span class="st">"arrow"</span>, <span class="st">"pins"</span>, <span class="st">"usethis"</span>,</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ggtext"</span>, <span class="st">"forcats"</span>, <span class="st">"cowplot"</span>, <span class="st">"ggdendro"</span>,</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">"gplots"</span>, <span class="st">"GGally"</span>, <span class="st">"dagitty"</span>, <span class="st">"ggdag"</span>, <span class="st">"simDAG"</span>,</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"future"</span>, <span class="st">"furrr"</span>, <span class="st">"rstan"</span>, <span class="st">"bnlearn"</span>, <span class="st">"Rgraphviz"</span>,</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"brms"</span>, <span class="st">"bayesplot"</span>, <span class="st">"tidybayes"</span>, <span class="st">"cmdstanr"</span>,</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nadiv"</span>, <span class="st">"graph4lg"</span>, <span class="st">"marginaleffects"</span>, <span class="st">"bayesplot"</span>, <span class="st">"rethinking"</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Install missing packages with pak</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>missing_pkgs <span class="ot">&lt;-</span> packages[<span class="sc">!</span><span class="fu">sapply</span>(packages, requireNamespace, <span class="at">quietly =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_pkgs) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>  pak<span class="sc">::</span><span class="fu">pkg_install</span>(missing_pkgs, <span class="at">ask =</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Installed:"</span>, <span class="fu">paste</span>(missing_pkgs, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"All Packages Installed :) </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Load all packages</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">sapply</span>(packages, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>))</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">color_scheme_set</span>(<span class="st">"blue"</span>)                                    <span class="co"># Set color scheme</span></span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())                            <span class="co"># Parallel Chains</span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Production Sever Settings</span></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>cmdstanr<span class="sc">::</span><span class="fu">set_cmdstan_path</span>(<span class="st">"/powerplant/workspace/hrltxm/workbench-k8s/stan/vanilla_stan/cmdstan-2.36.0"</span>)</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Without consideration of the causal structure underlying data, it is easy to draw incorrect conclusions.</span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Below is a simple example using a simulated dataset with four variables (Y, X, A, B).</span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>basic_dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a>  Y <span class="sc">~</span> X <span class="sc">+</span> A,</span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a>  X <span class="sc">~</span> A,</span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a>  B <span class="sc">~</span> X <span class="sc">+</span> Y,</span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"X"</span>,</span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Y"</span>,</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">list</span>(</span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">3</span>, <span class="at">A =</span> <span class="dv">2</span>, <span class="at">B =</span> <span class="dv">2</span>),</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">1</span>, <span class="at">A =</span> <span class="dv">2</span>, <span class="at">B =</span> <span class="dv">0</span>)</span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a>basic_dag_plot <span class="ot">&lt;-</span> basic_dag <span class="sc">|&gt;</span> </span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"X"</span> <span class="sc">~</span> <span class="st">"Exposure"</span>,</span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Outcome"</span>,</span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(name, <span class="st">"A"</span>) <span class="sc">~</span> <span class="st">"Confounder"</span>,</span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(name, <span class="st">"B"</span>) <span class="sc">~</span> <span class="st">"Collider"</span></span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_label =</span> <span class="fu">case_match</span>(name,</span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X"</span> <span class="sc">~</span> <span class="st">"Treatment"</span>,</span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Outcome"</span>,</span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a>    <span class="st">"A"</span> <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B"</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(basic_dag_plot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> var_type), <span class="at">size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_richtext</span>(</span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">label.color =</span> <span class="cn">NA</span>,</span>
<span id="cb28-110"><a href="#cb28-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.padding =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">"pt"</span>)</span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(</span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(basic_dag_plot, var_type <span class="sc">!=</span> <span class="st">"Confounder"</span>), <span class="fu">aes</span>(<span class="at">label =</span> var_label), </span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.25</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb28-115"><a href="#cb28-115" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-116"><a href="#cb28-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(</span>
<span id="cb28-117"><a href="#cb28-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(basic_dag_plot, var_type <span class="sc">==</span> <span class="st">"Confounder"</span>), <span class="fu">aes</span>(<span class="at">label =</span> var_label), </span>
<span id="cb28-118"><a href="#cb28-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="fl">0.26</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb28-119"><a href="#cb28-119" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-120"><a href="#cb28-120" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_text</span>(</span>
<span id="cb28-121"><a href="#cb28-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> (x <span class="sc">+</span> xend) <span class="sc">/</span> <span class="dv">2</span>, <span class="at">y =</span> (y <span class="sc">+</span> yend <span class="sc">+</span> <span class="fl">0.4</span>) <span class="sc">/</span> <span class="dv">2</span>, <span class="at">label =</span>  <span class="fu">c</span>(<span class="st">""</span>,<span class="st">"1.10"</span>,<span class="st">""</span>,<span class="st">""</span>,<span class="st">"-1.70"</span>,<span class="st">"-1.90"</span>)),</span>
<span id="cb28-122"><a href="#cb28-122" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb28-123"><a href="#cb28-123" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-124"><a href="#cb28-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#44AA99"</span>, <span class="st">"#6699CC"</span>, <span class="st">"#882255"</span>,<span class="st">"#999933"</span>), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb28-125"><a href="#cb28-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>()</span>
<span id="cb28-126"><a href="#cb28-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-127"><a href="#cb28-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-128"><a href="#cb28-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-129"><a href="#cb28-129" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Simulated data" collapse="true"}</span>
<span id="cb28-132"><a href="#cb28-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-133"><a href="#cb28-133" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Simulated data</span></span>
<span id="cb28-134"><a href="#cb28-134" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb28-135"><a href="#cb28-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-136"><a href="#cb28-136" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">empty_dag</span>()</span>
<span id="cb28-137"><a href="#cb28-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-138"><a href="#cb28-138" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> dag <span class="sc">+</span> </span>
<span id="cb28-139"><a href="#cb28-139" aria-hidden="true" tabindex="-1"></a>  <span class="co"># parent nodes</span></span>
<span id="cb28-140"><a href="#cb28-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">node</span>(<span class="st">"a"</span>, <span class="at">type=</span><span class="st">"rnorm"</span>, <span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd=</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb28-141"><a href="#cb28-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-142"><a href="#cb28-142" aria-hidden="true" tabindex="-1"></a>  <span class="co"># child nodes</span></span>
<span id="cb28-143"><a href="#cb28-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">node</span>(<span class="st">"x"</span>, <span class="at">type=</span><span class="st">"gaussian"</span>, <span class="at">parents=</span><span class="fu">c</span>(<span class="st">"a"</span>),     <span class="at">betas=</span><span class="fu">c</span>(<span class="fl">3.6</span>),</span>
<span id="cb28-144"><a href="#cb28-144" aria-hidden="true" tabindex="-1"></a>       <span class="at">intercept=</span><span class="dv">12</span>,  <span class="at">error =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb28-145"><a href="#cb28-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">node</span>(<span class="st">"y"</span>, <span class="at">type=</span><span class="st">"gaussian"</span>, <span class="at">parents=</span><span class="fu">c</span>(<span class="st">"a"</span>,<span class="st">"x"</span>), <span class="at">betas=</span><span class="fu">c</span>(<span class="fl">1.1</span>, <span class="sc">-</span><span class="fl">1.7</span>),</span>
<span id="cb28-146"><a href="#cb28-146" aria-hidden="true" tabindex="-1"></a>       <span class="at">intercept=</span><span class="dv">12</span>,  <span class="at">error =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb28-147"><a href="#cb28-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">node</span>(<span class="st">"b"</span>, <span class="at">type=</span><span class="st">"gaussian"</span>, <span class="at">parents=</span><span class="fu">c</span>(<span class="st">"x"</span>,<span class="st">"y"</span>), <span class="at">betas=</span><span class="fu">c</span>(<span class="fl">2.5</span>, <span class="sc">-</span><span class="fl">1.9</span>),</span>
<span id="cb28-148"><a href="#cb28-148" aria-hidden="true" tabindex="-1"></a>       <span class="at">intercept=</span><span class="sc">-</span><span class="dv">15</span>, <span class="at">error =</span> <span class="dv">2</span>) </span>
<span id="cb28-149"><a href="#cb28-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-150"><a href="#cb28-150" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb28-151"><a href="#cb28-151" aria-hidden="true" tabindex="-1"></a>sim_dat <span class="ot">&lt;-</span> <span class="fu">sim_from_dag</span>(<span class="at">dag=</span>dag, <span class="at">n_sim=</span><span class="dv">1000</span>)</span>
<span id="cb28-152"><a href="#cb28-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-153"><a href="#cb28-153" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sim_dat)</span>
<span id="cb28-154"><a href="#cb28-154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-155"><a href="#cb28-155" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb28-156"><a href="#cb28-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-159"><a href="#cb28-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-160"><a href="#cb28-160" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb28-161"><a href="#cb28-161" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb28-162"><a href="#cb28-162" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb28-163"><a href="#cb28-163" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb28-164"><a href="#cb28-164" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-165"><a href="#cb28-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-166"><a href="#cb28-166" aria-hidden="true" tabindex="-1"></a>p1</span>
<span id="cb28-167"><a href="#cb28-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-168"><a href="#cb28-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-169"><a href="#cb28-169" aria-hidden="true" tabindex="-1"></a>**Figure 1:** DAG of the simulated data that shows the relationships (arrows) between the outcome (Y), treatment (X), and other measured variables (A + B). The numbers on the arrows represent the known magnitude and direction of relationships with Y.</span>
<span id="cb28-170"><a href="#cb28-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-171"><a href="#cb28-171" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Under the hood" collapse="true"}</span>
<span id="cb28-174"><a href="#cb28-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-175"><a href="#cb28-175" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 50%</span></span>
<span id="cb28-176"><a href="#cb28-176" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb28-177"><a href="#cb28-177" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb28-178"><a href="#cb28-178" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-179"><a href="#cb28-179" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb28-180"><a href="#cb28-180" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-show: hold</span></span>
<span id="cb28-181"><a href="#cb28-181" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: false</span></span>
<span id="cb28-182"><a href="#cb28-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb28-183"><a href="#cb28-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-184"><a href="#cb28-184" aria-hidden="true" tabindex="-1"></a>sim_dat <span class="sc">|&gt;</span></span>
<span id="cb28-185"><a href="#cb28-185" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">x =</span> x, <span class="at">color =</span> a)) <span class="sc">+</span></span>
<span id="cb28-186"><a href="#cb28-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb28-187"><a href="#cb28-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb28-188"><a href="#cb28-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ x'</span>) <span class="sc">+</span></span>
<span id="cb28-189"><a href="#cb28-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb28-190"><a href="#cb28-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">20</span>,<span class="dv">120</span>) <span class="sc">+</span></span>
<span id="cb28-191"><a href="#cb28-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">150</span>,<span class="dv">20</span>)</span>
<span id="cb28-192"><a href="#cb28-192" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-193"><a href="#cb28-193" aria-hidden="true" tabindex="-1"></a>sim_dat <span class="sc">|&gt;</span></span>
<span id="cb28-194"><a href="#cb28-194" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">x =</span> x, <span class="at">color =</span> b)) <span class="sc">+</span></span>
<span id="cb28-195"><a href="#cb28-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb28-196"><a href="#cb28-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb28-197"><a href="#cb28-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ x'</span>) <span class="sc">+</span></span>
<span id="cb28-198"><a href="#cb28-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb28-199"><a href="#cb28-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">20</span>,<span class="dv">120</span>) <span class="sc">+</span></span>
<span id="cb28-200"><a href="#cb28-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">150</span>,<span class="dv">20</span>)</span>
<span id="cb28-201"><a href="#cb28-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-202"><a href="#cb28-202" aria-hidden="true" tabindex="-1"></a>sim_dat <span class="sc">|&gt;</span></span>
<span id="cb28-203"><a href="#cb28-203" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> x, <span class="at">x =</span> a, <span class="at">color =</span> b)) <span class="sc">+</span></span>
<span id="cb28-204"><a href="#cb28-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb28-205"><a href="#cb28-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb28-206"><a href="#cb28-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ x'</span>) <span class="sc">+</span></span>
<span id="cb28-207"><a href="#cb28-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>()</span>
<span id="cb28-208"><a href="#cb28-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-209"><a href="#cb28-209" aria-hidden="true" tabindex="-1"></a>sim_dat <span class="sc">|&gt;</span></span>
<span id="cb28-210"><a href="#cb28-210" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">x =</span> a, <span class="at">color =</span> b)) <span class="sc">+</span></span>
<span id="cb28-211"><a href="#cb28-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb28-212"><a href="#cb28-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb28-213"><a href="#cb28-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ x'</span>) <span class="sc">+</span></span>
<span id="cb28-214"><a href="#cb28-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>()</span>
<span id="cb28-215"><a href="#cb28-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-216"><a href="#cb28-216" aria-hidden="true" tabindex="-1"></a>sim_dat <span class="sc">|&gt;</span></span>
<span id="cb28-217"><a href="#cb28-217" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> b, <span class="at">x =</span> x, <span class="at">color =</span> a)) <span class="sc">+</span></span>
<span id="cb28-218"><a href="#cb28-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb28-219"><a href="#cb28-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb28-220"><a href="#cb28-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ x'</span>) <span class="sc">+</span></span>
<span id="cb28-221"><a href="#cb28-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>()</span>
<span id="cb28-222"><a href="#cb28-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-223"><a href="#cb28-223" aria-hidden="true" tabindex="-1"></a>sim_dat <span class="sc">|&gt;</span></span>
<span id="cb28-224"><a href="#cb28-224" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> b, <span class="at">x =</span> y, <span class="at">color =</span> a)) <span class="sc">+</span></span>
<span id="cb28-225"><a href="#cb28-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb28-226"><a href="#cb28-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb28-227"><a href="#cb28-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ x'</span>) <span class="sc">+</span></span>
<span id="cb28-228"><a href="#cb28-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>()</span>
<span id="cb28-229"><a href="#cb28-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-230"><a href="#cb28-230" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb28-231"><a href="#cb28-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-232"><a href="#cb28-232" aria-hidden="true" tabindex="-1"></a><span class="fu"># Science before statistics</span></span>
<span id="cb28-233"><a href="#cb28-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-234"><a href="#cb28-234" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Most approaches fail to recover the simulated value of -1.70.</span>
<span id="cb28-235"><a href="#cb28-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-236"><a href="#cb28-236" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb28-237"><a href="#cb28-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-238"><a href="#cb28-238" aria-hidden="true" tabindex="-1"></a><span class="fu">## Models</span></span>
<span id="cb28-239"><a href="#cb28-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-242"><a href="#cb28-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-243"><a href="#cb28-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: models</span></span>
<span id="cb28-244"><a href="#cb28-244" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb28-245"><a href="#cb28-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-246"><a href="#cb28-246" aria-hidden="true" tabindex="-1"></a>fit_brm <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, model_name) {</span>
<span id="cb28-247"><a href="#cb28-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(formula,</span>
<span id="cb28-248"><a href="#cb28-248" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb28-249"><a href="#cb28-249" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> sim_dat,</span>
<span id="cb28-250"><a href="#cb28-250" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">here</span>(<span class="st">"Analysis/Models/"</span>, model_name)),</span>
<span id="cb28-251"><a href="#cb28-251" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb28-252"><a href="#cb28-252" aria-hidden="true" tabindex="-1"></a>      <span class="at">threads =</span> <span class="fu">threading</span>(<span class="dv">3</span>),</span>
<span id="cb28-253"><a href="#cb28-253" aria-hidden="true" tabindex="-1"></a>      <span class="at">silent =</span> <span class="dv">0</span>,</span>
<span id="cb28-254"><a href="#cb28-254" aria-hidden="true" tabindex="-1"></a>      <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb28-255"><a href="#cb28-255" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb28-256"><a href="#cb28-256" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb28-257"><a href="#cb28-257" aria-hidden="true" tabindex="-1"></a>      <span class="at">warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb28-258"><a href="#cb28-258" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>)</span>
<span id="cb28-259"><a href="#cb28-259" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-260"><a href="#cb28-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-261"><a href="#cb28-261" aria-hidden="true" tabindex="-1"></a><span class="co"># Models</span></span>
<span id="cb28-262"><a href="#cb28-262" aria-hidden="true" tabindex="-1"></a>mod_1 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(y <span class="sc">~</span> x, <span class="st">"mod_1"</span>)         <span class="co"># Univariate</span></span>
<span id="cb28-263"><a href="#cb28-263" aria-hidden="true" tabindex="-1"></a>mod_2 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(y <span class="sc">~</span> a, <span class="st">"mod_2"</span>)         <span class="co"># Univariate</span></span>
<span id="cb28-264"><a href="#cb28-264" aria-hidden="true" tabindex="-1"></a>mod_3 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(y <span class="sc">~</span> b, <span class="st">"mod_3"</span>)         <span class="co"># Univariate</span></span>
<span id="cb28-265"><a href="#cb28-265" aria-hidden="true" tabindex="-1"></a>mod_4 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(y <span class="sc">~</span> x <span class="sc">+</span> a <span class="sc">+</span> b, <span class="st">"mod_4"</span>) <span class="co"># Casual Salad</span></span>
<span id="cb28-266"><a href="#cb28-266" aria-hidden="true" tabindex="-1"></a>mod_5 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(y <span class="sc">~</span> x <span class="sc">+</span> a, <span class="st">"mod_5"</span>)     <span class="co"># Confounder</span></span>
<span id="cb28-267"><a href="#cb28-267" aria-hidden="true" tabindex="-1"></a>mod_6 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(y <span class="sc">~</span> x <span class="sc">+</span> b, <span class="st">"mod_6"</span>)     <span class="co"># Collider</span></span>
<span id="cb28-268"><a href="#cb28-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-269"><a href="#cb28-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-270"><a href="#cb28-270" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output</span></span>
<span id="cb28-271"><a href="#cb28-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-274"><a href="#cb28-274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-275"><a href="#cb28-275" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: model-output</span></span>
<span id="cb28-276"><a href="#cb28-276" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-277"><a href="#cb28-277" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb28-278"><a href="#cb28-278" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_1)</span>
<span id="cb28-279"><a href="#cb28-279" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_2)</span>
<span id="cb28-280"><a href="#cb28-280" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_3)</span>
<span id="cb28-281"><a href="#cb28-281" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_4)</span>
<span id="cb28-282"><a href="#cb28-282" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_5)</span>
<span id="cb28-283"><a href="#cb28-283" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_6)</span>
<span id="cb28-284"><a href="#cb28-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-285"><a href="#cb28-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-286"><a href="#cb28-286" aria-hidden="true" tabindex="-1"></a><span class="fu">## Validation</span></span>
<span id="cb28-287"><a href="#cb28-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-290"><a href="#cb28-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-291"><a href="#cb28-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: validation</span></span>
<span id="cb28-292"><a href="#cb28-292" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-293"><a href="#cb28-293" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb28-294"><a href="#cb28-294" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-show: hold</span></span>
<span id="cb28-295"><a href="#cb28-295" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: false</span></span>
<span id="cb28-296"><a href="#cb28-296" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb28-297"><a href="#cb28-297" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 4</span></span>
<span id="cb28-298"><a href="#cb28-298" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 2</span></span>
<span id="cb28-299"><a href="#cb28-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-300"><a href="#cb28-300" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(mod_1)</span>
<span id="cb28-301"><a href="#cb28-301" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(mod_2)</span>
<span id="cb28-302"><a href="#cb28-302" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(mod_3)</span>
<span id="cb28-303"><a href="#cb28-303" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(mod_4)</span>
<span id="cb28-304"><a href="#cb28-304" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(mod_5)</span>
<span id="cb28-305"><a href="#cb28-305" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(mod_6)</span>
<span id="cb28-306"><a href="#cb28-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-307"><a href="#cb28-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-308"><a href="#cb28-308" aria-hidden="true" tabindex="-1"></a><span class="fu">## Coefficients</span></span>
<span id="cb28-309"><a href="#cb28-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-312"><a href="#cb28-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-313"><a href="#cb28-313" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: coefficients</span></span>
<span id="cb28-314"><a href="#cb28-314" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-315"><a href="#cb28-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-316"><a href="#cb28-316" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"mod_1:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(mod_1)<span class="sc">$</span>fixed<span class="sc">$</span>Estimate[[<span class="dv">2</span>]], <span class="dv">2</span>))</span>
<span id="cb28-317"><a href="#cb28-317" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"mod_2:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(mod_2)<span class="sc">$</span>fixed<span class="sc">$</span>Estimate[[<span class="dv">2</span>]], <span class="dv">2</span>))</span>
<span id="cb28-318"><a href="#cb28-318" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"mod_3:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(mod_3)<span class="sc">$</span>fixed<span class="sc">$</span>Estimate[[<span class="dv">2</span>]], <span class="dv">2</span>))</span>
<span id="cb28-319"><a href="#cb28-319" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"mod_4: "</span>, <span class="fu">paste</span>(<span class="fu">round</span>(<span class="fu">summary</span>(mod_4)<span class="sc">$</span>fixed<span class="sc">$</span>Estimate[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">2</span>), <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb28-320"><a href="#cb28-320" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"mod_5:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(mod_5)<span class="sc">$</span>fixed<span class="sc">$</span>Estimate[[<span class="dv">2</span>]], <span class="dv">2</span>))</span>
<span id="cb28-321"><a href="#cb28-321" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"mod_6:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(mod_6)<span class="sc">$</span>fixed<span class="sc">$</span>Estimate[[<span class="dv">2</span>]], <span class="dv">2</span>))</span>
<span id="cb28-322"><a href="#cb28-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-323"><a href="#cb28-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-324"><a href="#cb28-324" aria-hidden="true" tabindex="-1"></a><span class="fu">## Stan code</span></span>
<span id="cb28-325"><a href="#cb28-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-328"><a href="#cb28-328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-329"><a href="#cb28-329" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: stan_1</span></span>
<span id="cb28-330"><a href="#cb28-330" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-331"><a href="#cb28-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-332"><a href="#cb28-332" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Example Stan code for mod_1"</span>)</span>
<span id="cb28-333"><a href="#cb28-333" aria-hidden="true" tabindex="-1"></a><span class="fu">make_stancode</span>(y <span class="sc">~</span> x, <span class="at">data =</span> sim_dat, <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">"identity"</span>))</span>
<span id="cb28-334"><a href="#cb28-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-335"><a href="#cb28-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-336"><a href="#cb28-336" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb28-337"><a href="#cb28-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-340"><a href="#cb28-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-341"><a href="#cb28-341" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 50%</span></span>
<span id="cb28-342"><a href="#cb28-342" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb28-343"><a href="#cb28-343" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb28-344"><a href="#cb28-344" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-345"><a href="#cb28-345" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb28-346"><a href="#cb28-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: false</span></span>
<span id="cb28-347"><a href="#cb28-347" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb28-348"><a href="#cb28-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-349"><a href="#cb28-349" aria-hidden="true" tabindex="-1"></a>basic_dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb28-350"><a href="#cb28-350" aria-hidden="true" tabindex="-1"></a>  Y <span class="sc">~</span> X <span class="sc">+</span> A,</span>
<span id="cb28-351"><a href="#cb28-351" aria-hidden="true" tabindex="-1"></a>  X <span class="sc">~</span> A,</span>
<span id="cb28-352"><a href="#cb28-352" aria-hidden="true" tabindex="-1"></a>  B <span class="sc">~</span> X <span class="sc">+</span> Y,</span>
<span id="cb28-353"><a href="#cb28-353" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"X"</span>,</span>
<span id="cb28-354"><a href="#cb28-354" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Y"</span>,</span>
<span id="cb28-355"><a href="#cb28-355" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">list</span>(</span>
<span id="cb28-356"><a href="#cb28-356" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">3</span>, <span class="at">A =</span> <span class="dv">2</span>, <span class="at">B =</span> <span class="dv">2</span>),</span>
<span id="cb28-357"><a href="#cb28-357" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">1</span>, <span class="at">A =</span> <span class="dv">2</span>, <span class="at">B =</span> <span class="dv">0</span>)</span>
<span id="cb28-358"><a href="#cb28-358" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-359"><a href="#cb28-359" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-360"><a href="#cb28-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-361"><a href="#cb28-361" aria-hidden="true" tabindex="-1"></a>basic_dag_plot <span class="ot">&lt;-</span> basic_dag <span class="sc">|&gt;</span> </span>
<span id="cb28-362"><a href="#cb28-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb28-363"><a href="#cb28-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-364"><a href="#cb28-364" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"X"</span> <span class="sc">~</span> <span class="st">"Exposure"</span>,</span>
<span id="cb28-365"><a href="#cb28-365" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Outcome"</span>,</span>
<span id="cb28-366"><a href="#cb28-366" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(name, <span class="st">"A"</span>) <span class="sc">~</span> <span class="st">"Confounder"</span>,</span>
<span id="cb28-367"><a href="#cb28-367" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(name, <span class="st">"B"</span>) <span class="sc">~</span> <span class="st">"Collider"</span></span>
<span id="cb28-368"><a href="#cb28-368" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb28-369"><a href="#cb28-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_label =</span> <span class="fu">case_match</span>(name,</span>
<span id="cb28-370"><a href="#cb28-370" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X"</span> <span class="sc">~</span> <span class="st">"Treatment"</span>,</span>
<span id="cb28-371"><a href="#cb28-371" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Outcome"</span>,</span>
<span id="cb28-372"><a href="#cb28-372" aria-hidden="true" tabindex="-1"></a>    <span class="st">"A"</span> <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb28-373"><a href="#cb28-373" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B"</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb28-374"><a href="#cb28-374" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb28-375"><a href="#cb28-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-376"><a href="#cb28-376" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(basic_dag_plot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb28-377"><a href="#cb28-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb28-378"><a href="#cb28-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> var_type), <span class="at">size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb28-379"><a href="#cb28-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_richtext</span>(</span>
<span id="cb28-380"><a href="#cb28-380" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb28-381"><a href="#cb28-381" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">label.color =</span> <span class="cn">NA</span>,</span>
<span id="cb28-382"><a href="#cb28-382" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.padding =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">"pt"</span>)</span>
<span id="cb28-383"><a href="#cb28-383" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb28-384"><a href="#cb28-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(</span>
<span id="cb28-385"><a href="#cb28-385" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(basic_dag_plot, var_type <span class="sc">!=</span> <span class="st">"Confounder"</span>), <span class="fu">aes</span>(<span class="at">label =</span> var_label), </span>
<span id="cb28-386"><a href="#cb28-386" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.25</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb28-387"><a href="#cb28-387" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-388"><a href="#cb28-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(</span>
<span id="cb28-389"><a href="#cb28-389" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(basic_dag_plot, var_type <span class="sc">==</span> <span class="st">"Confounder"</span>), <span class="fu">aes</span>(<span class="at">label =</span> var_label), </span>
<span id="cb28-390"><a href="#cb28-390" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="fl">0.26</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb28-391"><a href="#cb28-391" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-392"><a href="#cb28-392" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_text</span>(</span>
<span id="cb28-393"><a href="#cb28-393" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> (x <span class="sc">+</span> xend) <span class="sc">/</span> <span class="dv">2</span>, <span class="at">y =</span> (y <span class="sc">+</span> yend <span class="sc">+</span> <span class="fl">0.4</span>) <span class="sc">/</span> <span class="dv">2</span>, <span class="at">label =</span>  <span class="fu">c</span>(<span class="st">""</span>,<span class="st">"-5.04"</span>,<span class="st">""</span>,<span class="st">""</span>,<span class="st">"-1.40"</span>,<span class="st">"-0.27"</span>)),</span>
<span id="cb28-394"><a href="#cb28-394" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb28-395"><a href="#cb28-395" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-396"><a href="#cb28-396" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggtitle</span>(<span class="st">"Univariate </span><span class="sc">\n</span><span class="st">y ~ x </span><span class="sc">\n</span><span class="st">y ~ a </span><span class="sc">\n</span><span class="st">y ~ b"</span>) <span class="sc">+</span></span>
<span id="cb28-397"><a href="#cb28-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#44AA99"</span>, <span class="st">"#6699CC"</span>, <span class="st">"#882255"</span>,<span class="st">"#999933"</span>), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb28-398"><a href="#cb28-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>()</span>
<span id="cb28-399"><a href="#cb28-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-400"><a href="#cb28-400" aria-hidden="true" tabindex="-1"></a>basic_dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb28-401"><a href="#cb28-401" aria-hidden="true" tabindex="-1"></a>  Y <span class="sc">~</span> X <span class="sc">+</span> A,</span>
<span id="cb28-402"><a href="#cb28-402" aria-hidden="true" tabindex="-1"></a>  X <span class="sc">~</span> A,</span>
<span id="cb28-403"><a href="#cb28-403" aria-hidden="true" tabindex="-1"></a>  B <span class="sc">~</span> X <span class="sc">+</span> Y,</span>
<span id="cb28-404"><a href="#cb28-404" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"X"</span>,</span>
<span id="cb28-405"><a href="#cb28-405" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Y"</span>,</span>
<span id="cb28-406"><a href="#cb28-406" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">list</span>(</span>
<span id="cb28-407"><a href="#cb28-407" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">3</span>, <span class="at">A =</span> <span class="dv">2</span>, <span class="at">B =</span> <span class="dv">2</span>),</span>
<span id="cb28-408"><a href="#cb28-408" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">1</span>, <span class="at">A =</span> <span class="dv">2</span>, <span class="at">B =</span> <span class="dv">0</span>)</span>
<span id="cb28-409"><a href="#cb28-409" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-410"><a href="#cb28-410" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-411"><a href="#cb28-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-412"><a href="#cb28-412" aria-hidden="true" tabindex="-1"></a>basic_dag_plot <span class="ot">&lt;-</span> basic_dag <span class="sc">|&gt;</span> </span>
<span id="cb28-413"><a href="#cb28-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb28-414"><a href="#cb28-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-415"><a href="#cb28-415" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"X"</span> <span class="sc">~</span> <span class="st">"Exposure"</span>,</span>
<span id="cb28-416"><a href="#cb28-416" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Outcome"</span>,</span>
<span id="cb28-417"><a href="#cb28-417" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(name, <span class="st">"A"</span>) <span class="sc">~</span> <span class="st">"Confounder"</span>,</span>
<span id="cb28-418"><a href="#cb28-418" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(name, <span class="st">"B"</span>) <span class="sc">~</span> <span class="st">"Collider"</span></span>
<span id="cb28-419"><a href="#cb28-419" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb28-420"><a href="#cb28-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_label =</span> <span class="fu">case_match</span>(name,</span>
<span id="cb28-421"><a href="#cb28-421" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X"</span> <span class="sc">~</span> <span class="st">"Treatment"</span>,</span>
<span id="cb28-422"><a href="#cb28-422" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Outcome"</span>,</span>
<span id="cb28-423"><a href="#cb28-423" aria-hidden="true" tabindex="-1"></a>    <span class="st">"A"</span> <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb28-424"><a href="#cb28-424" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B"</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb28-425"><a href="#cb28-425" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb28-426"><a href="#cb28-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-427"><a href="#cb28-427" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(basic_dag_plot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb28-428"><a href="#cb28-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb28-429"><a href="#cb28-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> var_type), <span class="at">size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb28-430"><a href="#cb28-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_richtext</span>(</span>
<span id="cb28-431"><a href="#cb28-431" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb28-432"><a href="#cb28-432" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">label.color =</span> <span class="cn">NA</span>,</span>
<span id="cb28-433"><a href="#cb28-433" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.padding =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">"pt"</span>)</span>
<span id="cb28-434"><a href="#cb28-434" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb28-435"><a href="#cb28-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(</span>
<span id="cb28-436"><a href="#cb28-436" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(basic_dag_plot, var_type <span class="sc">!=</span> <span class="st">"Confounder"</span>), <span class="fu">aes</span>(<span class="at">label =</span> var_label), </span>
<span id="cb28-437"><a href="#cb28-437" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.25</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb28-438"><a href="#cb28-438" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-439"><a href="#cb28-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(</span>
<span id="cb28-440"><a href="#cb28-440" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(basic_dag_plot, var_type <span class="sc">==</span> <span class="st">"Confounder"</span>), <span class="fu">aes</span>(<span class="at">label =</span> var_label), </span>
<span id="cb28-441"><a href="#cb28-441" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="fl">0.26</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb28-442"><a href="#cb28-442" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-443"><a href="#cb28-443" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_text</span>(</span>
<span id="cb28-444"><a href="#cb28-444" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> (x <span class="sc">+</span> xend) <span class="sc">/</span> <span class="dv">2</span>, <span class="at">y =</span> (y <span class="sc">+</span> yend <span class="sc">+</span> <span class="fl">0.4</span>) <span class="sc">/</span> <span class="dv">2</span>, <span class="at">label =</span>  <span class="fu">c</span>(<span class="st">""</span>,<span class="st">"0.15"</span>,<span class="st">""</span>,<span class="st">""</span>,<span class="st">"0.71"</span>,<span class="st">"-0.42"</span>)),</span>
<span id="cb28-445"><a href="#cb28-445" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb28-446"><a href="#cb28-446" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-447"><a href="#cb28-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Multiple linear regression</span><span class="sc">\n\"</span><span class="st">Causal salad</span><span class="sc">\"</span><span class="st"> </span><span class="sc">\n</span><span class="st">y ~ x + a + b</span><span class="sc">\n</span><span class="st">"</span>) <span class="sc">+</span></span>
<span id="cb28-448"><a href="#cb28-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#44AA99"</span>, <span class="st">"#6699CC"</span>, <span class="st">"#882255"</span>,<span class="st">"#999933"</span>), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb28-449"><a href="#cb28-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>()</span>
<span id="cb28-450"><a href="#cb28-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-451"><a href="#cb28-451" aria-hidden="true" tabindex="-1"></a>basic_dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb28-452"><a href="#cb28-452" aria-hidden="true" tabindex="-1"></a>  Y <span class="sc">~</span> X <span class="sc">+</span> A,</span>
<span id="cb28-453"><a href="#cb28-453" aria-hidden="true" tabindex="-1"></a>  X <span class="sc">~</span> A,</span>
<span id="cb28-454"><a href="#cb28-454" aria-hidden="true" tabindex="-1"></a>  B <span class="sc">~</span> X <span class="sc">+</span> Y,</span>
<span id="cb28-455"><a href="#cb28-455" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"X"</span>,</span>
<span id="cb28-456"><a href="#cb28-456" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Y"</span>,</span>
<span id="cb28-457"><a href="#cb28-457" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">list</span>(</span>
<span id="cb28-458"><a href="#cb28-458" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">3</span>, <span class="at">A =</span> <span class="dv">2</span>, <span class="at">B =</span> <span class="dv">2</span>),</span>
<span id="cb28-459"><a href="#cb28-459" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">1</span>, <span class="at">A =</span> <span class="dv">2</span>, <span class="at">B =</span> <span class="dv">0</span>)</span>
<span id="cb28-460"><a href="#cb28-460" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-461"><a href="#cb28-461" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-462"><a href="#cb28-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-463"><a href="#cb28-463" aria-hidden="true" tabindex="-1"></a>basic_dag_plot <span class="ot">&lt;-</span> basic_dag <span class="sc">|&gt;</span> </span>
<span id="cb28-464"><a href="#cb28-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb28-465"><a href="#cb28-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-466"><a href="#cb28-466" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"X"</span> <span class="sc">~</span> <span class="st">"Exposure"</span>,</span>
<span id="cb28-467"><a href="#cb28-467" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Outcome"</span>,</span>
<span id="cb28-468"><a href="#cb28-468" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(name, <span class="st">"A"</span>) <span class="sc">~</span> <span class="st">"Confounder"</span>,</span>
<span id="cb28-469"><a href="#cb28-469" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(name, <span class="st">"B"</span>) <span class="sc">~</span> <span class="st">"Collider"</span></span>
<span id="cb28-470"><a href="#cb28-470" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb28-471"><a href="#cb28-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_label =</span> <span class="fu">case_match</span>(name,</span>
<span id="cb28-472"><a href="#cb28-472" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X"</span> <span class="sc">~</span> <span class="st">"Treatment"</span>,</span>
<span id="cb28-473"><a href="#cb28-473" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Outcome"</span>,</span>
<span id="cb28-474"><a href="#cb28-474" aria-hidden="true" tabindex="-1"></a>    <span class="st">"A"</span> <span class="sc">~</span> <span class="st">"Confounder"</span>,</span>
<span id="cb28-475"><a href="#cb28-475" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B"</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb28-476"><a href="#cb28-476" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb28-477"><a href="#cb28-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-478"><a href="#cb28-478" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(basic_dag_plot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb28-479"><a href="#cb28-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb28-480"><a href="#cb28-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> var_type), <span class="at">size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb28-481"><a href="#cb28-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_richtext</span>(</span>
<span id="cb28-482"><a href="#cb28-482" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb28-483"><a href="#cb28-483" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">label.color =</span> <span class="cn">NA</span>,</span>
<span id="cb28-484"><a href="#cb28-484" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.padding =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">"pt"</span>)</span>
<span id="cb28-485"><a href="#cb28-485" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb28-486"><a href="#cb28-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(</span>
<span id="cb28-487"><a href="#cb28-487" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(basic_dag_plot, var_type <span class="sc">!=</span> <span class="st">"Confounder"</span>), <span class="fu">aes</span>(<span class="at">label =</span> var_label), </span>
<span id="cb28-488"><a href="#cb28-488" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.25</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb28-489"><a href="#cb28-489" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-490"><a href="#cb28-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(</span>
<span id="cb28-491"><a href="#cb28-491" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(basic_dag_plot, var_type <span class="sc">==</span> <span class="st">"Confounder"</span>), <span class="fu">aes</span>(<span class="at">label =</span> var_label), </span>
<span id="cb28-492"><a href="#cb28-492" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="fl">0.26</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb28-493"><a href="#cb28-493" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-494"><a href="#cb28-494" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_text</span>(</span>
<span id="cb28-495"><a href="#cb28-495" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> (x <span class="sc">+</span> xend) <span class="sc">/</span> <span class="dv">2</span>, <span class="at">y =</span> (y <span class="sc">+</span> yend <span class="sc">+</span> <span class="fl">0.4</span>) <span class="sc">/</span> <span class="dv">2</span>, <span class="at">label =</span>  <span class="fu">c</span>(<span class="st">""</span>,<span class="st">""</span>,<span class="st">""</span>,<span class="st">""</span>,<span class="st">"-1.72"</span>,<span class="st">""</span>)),</span>
<span id="cb28-496"><a href="#cb28-496" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb28-497"><a href="#cb28-497" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-498"><a href="#cb28-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Confounder </span><span class="sc">\n</span><span class="st">y ~ x + a </span><span class="sc">\n\n</span><span class="st">"</span>) <span class="sc">+</span></span>
<span id="cb28-499"><a href="#cb28-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#44AA99"</span>, <span class="st">"#6699CC"</span>, <span class="st">"#882255"</span>,<span class="st">"#999933"</span>), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb28-500"><a href="#cb28-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>()</span>
<span id="cb28-501"><a href="#cb28-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-502"><a href="#cb28-502" aria-hidden="true" tabindex="-1"></a>basic_dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb28-503"><a href="#cb28-503" aria-hidden="true" tabindex="-1"></a>  Y <span class="sc">~</span> X <span class="sc">+</span> A,</span>
<span id="cb28-504"><a href="#cb28-504" aria-hidden="true" tabindex="-1"></a>  X <span class="sc">~</span> A,</span>
<span id="cb28-505"><a href="#cb28-505" aria-hidden="true" tabindex="-1"></a>  B <span class="sc">~</span> X <span class="sc">+</span> Y,</span>
<span id="cb28-506"><a href="#cb28-506" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"X"</span>,</span>
<span id="cb28-507"><a href="#cb28-507" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Y"</span>,</span>
<span id="cb28-508"><a href="#cb28-508" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">list</span>(</span>
<span id="cb28-509"><a href="#cb28-509" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">3</span>, <span class="at">A =</span> <span class="dv">2</span>, <span class="at">B =</span> <span class="dv">2</span>),</span>
<span id="cb28-510"><a href="#cb28-510" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">1</span>, <span class="at">A =</span> <span class="dv">2</span>, <span class="at">B =</span> <span class="dv">0</span>)</span>
<span id="cb28-511"><a href="#cb28-511" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-512"><a href="#cb28-512" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-513"><a href="#cb28-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-514"><a href="#cb28-514" aria-hidden="true" tabindex="-1"></a>basic_dag_plot <span class="ot">&lt;-</span> basic_dag <span class="sc">|&gt;</span> </span>
<span id="cb28-515"><a href="#cb28-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb28-516"><a href="#cb28-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-517"><a href="#cb28-517" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"X"</span> <span class="sc">~</span> <span class="st">"Exposure"</span>,</span>
<span id="cb28-518"><a href="#cb28-518" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Outcome"</span>,</span>
<span id="cb28-519"><a href="#cb28-519" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(name, <span class="st">"A"</span>) <span class="sc">~</span> <span class="st">"Confounder"</span>,</span>
<span id="cb28-520"><a href="#cb28-520" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(name, <span class="st">"B"</span>) <span class="sc">~</span> <span class="st">"Collider"</span></span>
<span id="cb28-521"><a href="#cb28-521" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb28-522"><a href="#cb28-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_label =</span> <span class="fu">case_match</span>(name,</span>
<span id="cb28-523"><a href="#cb28-523" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X"</span> <span class="sc">~</span> <span class="st">"Treatment"</span>,</span>
<span id="cb28-524"><a href="#cb28-524" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Outcome"</span>,</span>
<span id="cb28-525"><a href="#cb28-525" aria-hidden="true" tabindex="-1"></a>    <span class="st">"A"</span> <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb28-526"><a href="#cb28-526" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B"</span> <span class="sc">~</span> <span class="st">"Collider"</span></span>
<span id="cb28-527"><a href="#cb28-527" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb28-528"><a href="#cb28-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-529"><a href="#cb28-529" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(basic_dag_plot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb28-530"><a href="#cb28-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb28-531"><a href="#cb28-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> var_type), <span class="at">size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb28-532"><a href="#cb28-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_richtext</span>(</span>
<span id="cb28-533"><a href="#cb28-533" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb28-534"><a href="#cb28-534" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">label.color =</span> <span class="cn">NA</span>,</span>
<span id="cb28-535"><a href="#cb28-535" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.padding =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">"pt"</span>)</span>
<span id="cb28-536"><a href="#cb28-536" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb28-537"><a href="#cb28-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(</span>
<span id="cb28-538"><a href="#cb28-538" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(basic_dag_plot, var_type <span class="sc">!=</span> <span class="st">"Confounder"</span>), <span class="fu">aes</span>(<span class="at">label =</span> var_label), </span>
<span id="cb28-539"><a href="#cb28-539" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.25</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb28-540"><a href="#cb28-540" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-541"><a href="#cb28-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(</span>
<span id="cb28-542"><a href="#cb28-542" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(basic_dag_plot, var_type <span class="sc">==</span> <span class="st">"Confounder"</span>), <span class="fu">aes</span>(<span class="at">label =</span> var_label), </span>
<span id="cb28-543"><a href="#cb28-543" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="fl">0.26</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb28-544"><a href="#cb28-544" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-545"><a href="#cb28-545" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_text</span>(</span>
<span id="cb28-546"><a href="#cb28-546" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> (x <span class="sc">+</span> xend) <span class="sc">/</span> <span class="dv">2</span>, <span class="at">y =</span> (y <span class="sc">+</span> yend <span class="sc">+</span> <span class="fl">0.4</span>) <span class="sc">/</span> <span class="dv">2</span>, <span class="at">label =</span>  <span class="fu">c</span>(<span class="st">""</span>,<span class="st">""</span>,<span class="st">""</span>,<span class="st">""</span>,<span class="st">"0.78"</span>,<span class="st">""</span>)),</span>
<span id="cb28-547"><a href="#cb28-547" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb28-548"><a href="#cb28-548" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-549"><a href="#cb28-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Collider </span><span class="sc">\n</span><span class="st">y ~ x + b </span><span class="sc">\n\n</span><span class="st">"</span>) <span class="sc">+</span></span>
<span id="cb28-550"><a href="#cb28-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#44AA99"</span>, <span class="st">"#6699CC"</span>, <span class="st">"#882255"</span>,<span class="st">"#999933"</span>), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb28-551"><a href="#cb28-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>()</span>
<span id="cb28-552"><a href="#cb28-552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-553"><a href="#cb28-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-554"><a href="#cb28-554" aria-hidden="true" tabindex="-1"></a>**Figure 2:** Various regression approaches to estimate the Y ~ X relationship (simulated value -1.71). Coefficients on arrows represent the estimated magnitude and direction of relationships. Conditioning on the confounder (A) returns the simulated value.</span>
<span id="cb28-555"><a href="#cb28-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-556"><a href="#cb28-556" aria-hidden="true" tabindex="-1"></a><span class="fu"># Everything, everywhere, all at once</span></span>
<span id="cb28-557"><a href="#cb28-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-558"><a href="#cb28-558" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Modeled as a series of structural equations that represent the data generating process.</span>
<span id="cb28-559"><a href="#cb28-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-560"><a href="#cb28-560" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb28-561"><a href="#cb28-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-562"><a href="#cb28-562" aria-hidden="true" tabindex="-1"></a><span class="fu">## Models</span></span>
<span id="cb28-563"><a href="#cb28-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-566"><a href="#cb28-566" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-567"><a href="#cb28-567" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: model_2</span></span>
<span id="cb28-568"><a href="#cb28-568" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb28-569"><a href="#cb28-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-570"><a href="#cb28-570" aria-hidden="true" tabindex="-1"></a><span class="co"># Model</span></span>
<span id="cb28-571"><a href="#cb28-571" aria-hidden="true" tabindex="-1"></a>se_1 <span class="ot">&lt;-</span> <span class="fu">bf</span>(x <span class="sc">~</span> a,     <span class="at">family =</span> gaussian)</span>
<span id="cb28-572"><a href="#cb28-572" aria-hidden="true" tabindex="-1"></a>se_2 <span class="ot">&lt;-</span> <span class="fu">bf</span>(y <span class="sc">~</span> x <span class="sc">+</span> a, <span class="at">family =</span> gaussian)</span>
<span id="cb28-573"><a href="#cb28-573" aria-hidden="true" tabindex="-1"></a>se_3 <span class="ot">&lt;-</span> <span class="fu">bf</span>(b <span class="sc">~</span> x <span class="sc">+</span> y, <span class="at">family =</span> gaussian)</span>
<span id="cb28-574"><a href="#cb28-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-575"><a href="#cb28-575" aria-hidden="true" tabindex="-1"></a>mod_7 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(se_1 <span class="sc">+</span> se_2 <span class="sc">+</span> se_3 <span class="sc">+</span> <span class="fu">set_rescor</span>(<span class="cn">FALSE</span>), <span class="st">"mod_7"</span>) <span class="co"># Full Luxury Bayesian Inference</span></span>
<span id="cb28-576"><a href="#cb28-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-577"><a href="#cb28-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-578"><a href="#cb28-578" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output</span></span>
<span id="cb28-579"><a href="#cb28-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-582"><a href="#cb28-582" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-583"><a href="#cb28-583" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: model-output_2</span></span>
<span id="cb28-584"><a href="#cb28-584" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-585"><a href="#cb28-585" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb28-586"><a href="#cb28-586" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_7)</span>
<span id="cb28-587"><a href="#cb28-587" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-588"><a href="#cb28-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-589"><a href="#cb28-589" aria-hidden="true" tabindex="-1"></a><span class="fu">## Validation</span></span>
<span id="cb28-590"><a href="#cb28-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-593"><a href="#cb28-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-594"><a href="#cb28-594" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: validation_2</span></span>
<span id="cb28-595"><a href="#cb28-595" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-596"><a href="#cb28-596" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb28-597"><a href="#cb28-597" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-show: hold</span></span>
<span id="cb28-598"><a href="#cb28-598" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: false</span></span>
<span id="cb28-599"><a href="#cb28-599" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 3</span></span>
<span id="cb28-600"><a href="#cb28-600" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 4</span></span>
<span id="cb28-601"><a href="#cb28-601" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 2</span></span>
<span id="cb28-602"><a href="#cb28-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-603"><a href="#cb28-603" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(mod_7, <span class="at">resp =</span> <span class="st">"y"</span>)</span>
<span id="cb28-604"><a href="#cb28-604" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(mod_7, <span class="at">resp =</span> <span class="st">"x"</span>)</span>
<span id="cb28-605"><a href="#cb28-605" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(mod_7, <span class="at">resp =</span> <span class="st">"b"</span>)</span>
<span id="cb28-606"><a href="#cb28-606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-607"><a href="#cb28-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-608"><a href="#cb28-608" aria-hidden="true" tabindex="-1"></a><span class="fu">## Coefficients</span></span>
<span id="cb28-609"><a href="#cb28-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-612"><a href="#cb28-612" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-613"><a href="#cb28-613" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: coefficients_2</span></span>
<span id="cb28-614"><a href="#cb28-614" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-615"><a href="#cb28-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-616"><a href="#cb28-616" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_7)<span class="sc">$</span>fixed</span>
<span id="cb28-617"><a href="#cb28-617" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-618"><a href="#cb28-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-619"><a href="#cb28-619" aria-hidden="true" tabindex="-1"></a><span class="fu">## Stan code</span></span>
<span id="cb28-620"><a href="#cb28-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-623"><a href="#cb28-623" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-624"><a href="#cb28-624" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: stan_2</span></span>
<span id="cb28-625"><a href="#cb28-625" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-626"><a href="#cb28-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-627"><a href="#cb28-627" aria-hidden="true" tabindex="-1"></a><span class="fu">make_stancode</span>(se_1 <span class="sc">+</span> se_2 <span class="sc">+</span> se_3 <span class="sc">+</span> <span class="fu">set_rescor</span>(<span class="cn">FALSE</span>), <span class="at">data =</span> sim_dat)</span>
<span id="cb28-628"><a href="#cb28-628" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-629"><a href="#cb28-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-630"><a href="#cb28-630" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb28-631"><a href="#cb28-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-634"><a href="#cb28-634" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-635"><a href="#cb28-635" aria-hidden="true" tabindex="-1"></a>basic_dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb28-636"><a href="#cb28-636" aria-hidden="true" tabindex="-1"></a>  Y <span class="sc">~</span> X <span class="sc">+</span> A,</span>
<span id="cb28-637"><a href="#cb28-637" aria-hidden="true" tabindex="-1"></a>  X <span class="sc">~</span> A,</span>
<span id="cb28-638"><a href="#cb28-638" aria-hidden="true" tabindex="-1"></a>  B <span class="sc">~</span> X <span class="sc">+</span> Y,</span>
<span id="cb28-639"><a href="#cb28-639" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"X"</span>,</span>
<span id="cb28-640"><a href="#cb28-640" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Y"</span>,</span>
<span id="cb28-641"><a href="#cb28-641" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">list</span>(</span>
<span id="cb28-642"><a href="#cb28-642" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">3</span>, <span class="at">A =</span> <span class="dv">2</span>, <span class="at">B =</span> <span class="dv">2</span>),</span>
<span id="cb28-643"><a href="#cb28-643" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="dv">1</span>, <span class="at">A =</span> <span class="dv">2</span>, <span class="at">B =</span> <span class="dv">0</span>)</span>
<span id="cb28-644"><a href="#cb28-644" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-645"><a href="#cb28-645" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-646"><a href="#cb28-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-647"><a href="#cb28-647" aria-hidden="true" tabindex="-1"></a>basic_dag_plot <span class="ot">&lt;-</span> basic_dag <span class="sc">|&gt;</span> </span>
<span id="cb28-648"><a href="#cb28-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb28-649"><a href="#cb28-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-650"><a href="#cb28-650" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"X"</span> <span class="sc">~</span> <span class="st">"Exposure"</span>,</span>
<span id="cb28-651"><a href="#cb28-651" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Outcome"</span>,</span>
<span id="cb28-652"><a href="#cb28-652" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(name, <span class="st">"A"</span>) <span class="sc">~</span> <span class="st">"Confounder"</span>,</span>
<span id="cb28-653"><a href="#cb28-653" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(name, <span class="st">"B"</span>) <span class="sc">~</span> <span class="st">"Collider"</span></span>
<span id="cb28-654"><a href="#cb28-654" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb28-655"><a href="#cb28-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_label =</span> <span class="fu">case_match</span>(name,</span>
<span id="cb28-656"><a href="#cb28-656" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X"</span> <span class="sc">~</span> <span class="st">"Treatment"</span>,</span>
<span id="cb28-657"><a href="#cb28-657" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Outcome"</span>,</span>
<span id="cb28-658"><a href="#cb28-658" aria-hidden="true" tabindex="-1"></a>    <span class="st">"A"</span> <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb28-659"><a href="#cb28-659" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B"</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb28-660"><a href="#cb28-660" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb28-661"><a href="#cb28-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-662"><a href="#cb28-662" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(basic_dag_plot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb28-663"><a href="#cb28-663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>() <span class="sc">+</span></span>
<span id="cb28-664"><a href="#cb28-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> var_type), <span class="at">size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb28-665"><a href="#cb28-665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_richtext</span>(</span>
<span id="cb28-666"><a href="#cb28-666" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb28-667"><a href="#cb28-667" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">label.color =</span> <span class="cn">NA</span>,</span>
<span id="cb28-668"><a href="#cb28-668" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.padding =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">"pt"</span>)</span>
<span id="cb28-669"><a href="#cb28-669" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb28-670"><a href="#cb28-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(</span>
<span id="cb28-671"><a href="#cb28-671" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(basic_dag_plot, var_type <span class="sc">!=</span> <span class="st">"Confounder"</span>), <span class="fu">aes</span>(<span class="at">label =</span> var_label), </span>
<span id="cb28-672"><a href="#cb28-672" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.25</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb28-673"><a href="#cb28-673" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-674"><a href="#cb28-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(</span>
<span id="cb28-675"><a href="#cb28-675" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(basic_dag_plot, var_type <span class="sc">==</span> <span class="st">"Confounder"</span>), <span class="fu">aes</span>(<span class="at">label =</span> var_label), </span>
<span id="cb28-676"><a href="#cb28-676" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="fl">0.26</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb28-677"><a href="#cb28-677" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-678"><a href="#cb28-678" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_text</span>(</span>
<span id="cb28-679"><a href="#cb28-679" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> (x <span class="sc">+</span> xend) <span class="sc">/</span> <span class="dv">2</span>, <span class="at">y =</span> (y <span class="sc">+</span> yend <span class="sc">+</span> <span class="fl">0.4</span>) <span class="sc">/</span> <span class="dv">2</span>, <span class="at">label =</span>  <span class="fu">c</span>(<span class="st">"3.60"</span>,<span class="st">"1.15"</span>,<span class="st">""</span>,<span class="st">"2.45"</span>,<span class="st">"-1.72"</span>,<span class="st">"-1.93"</span>)),</span>
<span id="cb28-680"><a href="#cb28-680" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb28-681"><a href="#cb28-681" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-682"><a href="#cb28-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#44AA99"</span>, <span class="st">"#6699CC"</span>, <span class="st">"#882255"</span>,<span class="st">"#999933"</span>), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb28-683"><a href="#cb28-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>()</span>
<span id="cb28-684"><a href="#cb28-684" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-685"><a href="#cb28-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-686"><a href="#cb28-686" aria-hidden="true" tabindex="-1"></a><span class="fu"># Genralised linear madness</span></span>
<span id="cb28-687"><a href="#cb28-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-688"><a href="#cb28-688" aria-hidden="true" tabindex="-1"></a>This analysis demonstrates science before statistics by incorporating prior knowledge in the modeling approach. Scientific phenomena are often modeled as linear relationships (i.e., generalized linear (mixed) models), which may not capture the data generating process.</span>
<span id="cb28-689"><a href="#cb28-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-690"><a href="#cb28-690" aria-hidden="true" tabindex="-1"></a>Fitting non-linear models such as logarithmic, polynomial curves, or splines may give us a good prediction of relationships, but doesn't allow us to estimate parameters of interest (e.g., maximum value or growth rate).</span>
<span id="cb28-691"><a href="#cb28-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-692"><a href="#cb28-692" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data and Methods</span></span>
<span id="cb28-693"><a href="#cb28-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-694"><a href="#cb28-694" aria-hidden="true" tabindex="-1"></a>During my PhD, I measured the length and weight of ~3000 freshwater mussels (yes I'm that exciting!). I want to describe the relationship between length and weight between mussels collected inside macrophyte beds (aquatic plant beds: treatment) vs not (control) based on how the data was generated. </span>
<span id="cb28-695"><a href="#cb28-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-696"><a href="#cb28-696" aria-hidden="true" tabindex="-1"></a>Although the length-weight relationship isn't technically a temporal relationship (even I'm not going to measure ~3000 mussels repeatedly over time), substituting time for space (length) will allow us to fit a models that estimate the: a) maximum weight; and b) growth rate. </span>
<span id="cb28-697"><a href="#cb28-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-698"><a href="#cb28-698" aria-hidden="true" tabindex="-1"></a>To examine the relationship between the length and weight of freshwater mussels, generalized (non-)linear models were performed in R (R Core Team 2022) using the brms package (Bürkner, 2017). Linear, Gompertz (modified), and Logistic models were fitted with treatment (none vs macrophyte) as a predictor variable. A Gamma distribution was selected for the response since weight has positive and continuous values. Models were compared using leave-one-out cross validation and model validation was performed using prior and posterior predictive checks, as well as effective samples sizes and r-hats (McElreath, 2020).</span>
<span id="cb28-699"><a href="#cb28-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-700"><a href="#cb28-700" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Data" collapse="true"}</span>
<span id="cb28-703"><a href="#cb28-703" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-704"><a href="#cb28-704" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"Analysis/Data/Mussel_df_15.01.20.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="co"># Import .csv file</span></span>
<span id="cb28-705"><a href="#cb28-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-706"><a href="#cb28-706" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(Length,Height,Width,Weight,Treatment,Macrophyte,Site))</span>
<span id="cb28-707"><a href="#cb28-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-708"><a href="#cb28-708" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[<span class="fu">complete.cases</span>(df),]  <span class="co"># Select only complete cases</span></span>
<span id="cb28-709"><a href="#cb28-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-710"><a href="#cb28-710" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span>
<span id="cb28-711"><a href="#cb28-711" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-712"><a href="#cb28-712" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb28-713"><a href="#cb28-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-714"><a href="#cb28-714" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb28-715"><a href="#cb28-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-716"><a href="#cb28-716" aria-hidden="true" tabindex="-1"></a><span class="fu">### Prior linear</span></span>
<span id="cb28-717"><a href="#cb28-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-720"><a href="#cb28-720" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-721"><a href="#cb28-721" aria-hidden="true" tabindex="-1"></a>mod_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(Weight <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Length <span class="sc">+</span> Treatment)</span>
<span id="cb28-722"><a href="#cb28-722" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-723"><a href="#cb28-723" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="at">class =</span> b, <span class="at">coef =</span> Intercept, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>)),       <span class="co"># Intercept</span></span>
<span id="cb28-724"><a href="#cb28-724" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="at">coef =</span> TreatmentNone, <span class="fu">normal</span>(<span class="dv">50</span>,<span class="dv">5</span>)),  <span class="co"># Difference between treatments</span></span>
<span id="cb28-725"><a href="#cb28-725" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">lb =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">ub =</span> <span class="sc">-</span><span class="dv">2</span>)      <span class="co"># Slope </span></span>
<span id="cb28-726"><a href="#cb28-726" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb28-727"><a href="#cb28-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-728"><a href="#cb28-728" aria-hidden="true" tabindex="-1"></a><span class="co"># Priors</span></span>
<span id="cb28-729"><a href="#cb28-729" aria-hidden="true" tabindex="-1"></a>nl_mod_1_priors <span class="ot">&lt;-</span> <span class="fu">brm</span>(mod_formula, <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb28-730"><a href="#cb28-730" aria-hidden="true" tabindex="-1"></a>             <span class="at">prior =</span> priors, </span>
<span id="cb28-731"><a href="#cb28-731" aria-hidden="true" tabindex="-1"></a>             <span class="at">sample_prior =</span> <span class="st">"only"</span>, <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb28-732"><a href="#cb28-732" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> df, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">here</span>(<span class="st">"Analysis/Models/NL_mod_1_priors_bad"</span>)),</span>
<span id="cb28-733"><a href="#cb28-733" aria-hidden="true" tabindex="-1"></a>             <span class="at">threads =</span> <span class="fu">threading</span>(<span class="at">threads =</span> <span class="cn">NULL</span>, <span class="at">grainsize =</span> <span class="dv">1250</span>, <span class="at">static =</span> <span class="cn">FALSE</span>),</span>
<span id="cb28-734"><a href="#cb28-734" aria-hidden="true" tabindex="-1"></a>             <span class="at">backend =</span> <span class="st">"cmdstanr"</span>, <span class="at">silent =</span> <span class="dv">0</span>, <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb28-735"><a href="#cb28-735" aria-hidden="true" tabindex="-1"></a>             <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">iter =</span> <span class="dv">2000</span>)</span>
<span id="cb28-736"><a href="#cb28-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-737"><a href="#cb28-737" aria-hidden="true" tabindex="-1"></a><span class="fu">conditional_effects</span>(nl_mod_1_priors, <span class="at">effect =</span> <span class="st">"Length"</span>, <span class="at">spaghetti =</span> T, <span class="at">ndraws =</span> <span class="dv">100</span>)</span>
<span id="cb28-738"><a href="#cb28-738" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-739"><a href="#cb28-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-740"><a href="#cb28-740" aria-hidden="true" tabindex="-1"></a><span class="fu">### Prior Gompertz</span></span>
<span id="cb28-741"><a href="#cb28-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-744"><a href="#cb28-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-745"><a href="#cb28-745" aria-hidden="true" tabindex="-1"></a>mod_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(Weight <span class="sc">~</span> k <span class="sc">*</span> <span class="fu">exp</span>( <span class="sc">-</span><span class="fu">exp</span>( <span class="sc">-</span>(r <span class="sc">*</span> (Length <span class="sc">-</span> delay)))),</span>
<span id="cb28-746"><a href="#cb28-746" aria-hidden="true" tabindex="-1"></a>                  k <span class="sc">+</span> r <span class="sc">+</span> delay <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Treatment,</span>
<span id="cb28-747"><a href="#cb28-747" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nl =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-748"><a href="#cb28-748" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-749"><a href="#cb28-749" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"k"</span>,     <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">50</span>,<span class="dv">20</span>)),  <span class="co"># Max Weight </span></span>
<span id="cb28-750"><a href="#cb28-750" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"r"</span>,     <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.05</span>)), <span class="co"># Growth Rate</span></span>
<span id="cb28-751"><a href="#cb28-751" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"delay"</span>, <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">30</span>,<span class="dv">2</span>))    <span class="co"># Delay across the x-axis </span></span>
<span id="cb28-752"><a href="#cb28-752" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb28-753"><a href="#cb28-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-754"><a href="#cb28-754" aria-hidden="true" tabindex="-1"></a><span class="co"># Priors</span></span>
<span id="cb28-755"><a href="#cb28-755" aria-hidden="true" tabindex="-1"></a>nl_mod_2_priors <span class="ot">&lt;-</span> <span class="fu">brm</span>(mod_formula, <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb28-756"><a href="#cb28-756" aria-hidden="true" tabindex="-1"></a>             <span class="at">prior =</span> priors, </span>
<span id="cb28-757"><a href="#cb28-757" aria-hidden="true" tabindex="-1"></a>             <span class="at">sample_prior =</span> <span class="st">"only"</span>, <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb28-758"><a href="#cb28-758" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> df, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">here</span>(<span class="st">"Analysis//Models/NL_mod_2_priors_good"</span>)),</span>
<span id="cb28-759"><a href="#cb28-759" aria-hidden="true" tabindex="-1"></a>             <span class="at">threads =</span> <span class="fu">threading</span>(<span class="at">threads =</span> <span class="cn">NULL</span>, <span class="at">grainsize =</span> <span class="dv">1250</span>, <span class="at">static =</span> <span class="cn">FALSE</span>),</span>
<span id="cb28-760"><a href="#cb28-760" aria-hidden="true" tabindex="-1"></a>             <span class="at">backend =</span> <span class="st">"cmdstanr"</span>, <span class="at">silent =</span> <span class="dv">1</span>, <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb28-761"><a href="#cb28-761" aria-hidden="true" tabindex="-1"></a>             <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">iter =</span> <span class="dv">2000</span>)</span>
<span id="cb28-762"><a href="#cb28-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-763"><a href="#cb28-763" aria-hidden="true" tabindex="-1"></a><span class="fu">conditional_effects</span>(nl_mod_2_priors, <span class="at">effect =</span> <span class="st">"Length"</span>, <span class="at">spaghetti =</span> T, <span class="at">ndraws =</span> <span class="dv">100</span>)</span>
<span id="cb28-764"><a href="#cb28-764" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-765"><a href="#cb28-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-766"><a href="#cb28-766" aria-hidden="true" tabindex="-1"></a><span class="fu">### Prior logistic</span></span>
<span id="cb28-767"><a href="#cb28-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-770"><a href="#cb28-770" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-771"><a href="#cb28-771" aria-hidden="true" tabindex="-1"></a>mod_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(Weight <span class="sc">~</span> M <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> (M <span class="sc">-</span> mu0) <span class="sc">/</span> mu0 <span class="sc">*</span> <span class="fu">exp</span>( <span class="sc">-</span>b <span class="sc">*</span> Length)),</span>
<span id="cb28-772"><a href="#cb28-772" aria-hidden="true" tabindex="-1"></a>                  mu0 <span class="sc">+</span> b <span class="sc">+</span> M <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Treatment,</span>
<span id="cb28-773"><a href="#cb28-773" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nl =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-774"><a href="#cb28-774" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-775"><a href="#cb28-775" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"mu0"</span>, <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.1</span>)),  <span class="co"># Weight at length zero</span></span>
<span id="cb28-776"><a href="#cb28-776" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"b"</span>,   <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.1</span>)),  <span class="co"># Growth rate</span></span>
<span id="cb28-777"><a href="#cb28-777" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"M"</span>,   <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">50</span>,<span class="dv">20</span>))   <span class="co"># Max Weight</span></span>
<span id="cb28-778"><a href="#cb28-778" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb28-779"><a href="#cb28-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-780"><a href="#cb28-780" aria-hidden="true" tabindex="-1"></a><span class="co"># Priors</span></span>
<span id="cb28-781"><a href="#cb28-781" aria-hidden="true" tabindex="-1"></a>nl_mod_3_priors <span class="ot">&lt;-</span> <span class="fu">brm</span>(mod_formula, <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb28-782"><a href="#cb28-782" aria-hidden="true" tabindex="-1"></a>             <span class="at">prior =</span> priors, </span>
<span id="cb28-783"><a href="#cb28-783" aria-hidden="true" tabindex="-1"></a>             <span class="at">sample_prior =</span> <span class="st">"only"</span>, <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb28-784"><a href="#cb28-784" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> df, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">here</span>(<span class="st">"Analysis/Models/NL_mod_3_priors_good"</span>)),</span>
<span id="cb28-785"><a href="#cb28-785" aria-hidden="true" tabindex="-1"></a>             <span class="at">threads =</span> <span class="fu">threading</span>(<span class="at">threads =</span> <span class="cn">NULL</span>, <span class="at">grainsize =</span> <span class="dv">1250</span>, <span class="at">static =</span> <span class="cn">FALSE</span>),</span>
<span id="cb28-786"><a href="#cb28-786" aria-hidden="true" tabindex="-1"></a>             <span class="at">backend =</span> <span class="st">"cmdstanr"</span>, <span class="at">silent =</span> <span class="dv">0</span>, <span class="at">refresh =</span> <span class="dv">100</span>,</span>
<span id="cb28-787"><a href="#cb28-787" aria-hidden="true" tabindex="-1"></a>             <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">iter =</span> <span class="dv">2000</span>)</span>
<span id="cb28-788"><a href="#cb28-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-789"><a href="#cb28-789" aria-hidden="true" tabindex="-1"></a><span class="fu">conditional_effects</span>(nl_mod_3_priors, <span class="at">effect =</span> <span class="st">"Length"</span>, <span class="at">spaghetti =</span> T, <span class="at">ndraws =</span> <span class="dv">100</span>)</span>
<span id="cb28-790"><a href="#cb28-790" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-791"><a href="#cb28-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-792"><a href="#cb28-792" aria-hidden="true" tabindex="-1"></a><span class="fu">### Models</span></span>
<span id="cb28-793"><a href="#cb28-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-796"><a href="#cb28-796" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-797"><a href="#cb28-797" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: model_3</span></span>
<span id="cb28-798"><a href="#cb28-798" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb28-799"><a href="#cb28-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-800"><a href="#cb28-800" aria-hidden="true" tabindex="-1"></a>fit_brm <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, model_name, priors) {</span>
<span id="cb28-801"><a href="#cb28-801" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(formula,</span>
<span id="cb28-802"><a href="#cb28-802" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb28-803"><a href="#cb28-803" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> df,</span>
<span id="cb28-804"><a href="#cb28-804" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> priors,</span>
<span id="cb28-805"><a href="#cb28-805" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">here</span>(<span class="st">"Analysis/Models/"</span>, model_name)),</span>
<span id="cb28-806"><a href="#cb28-806" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb28-807"><a href="#cb28-807" aria-hidden="true" tabindex="-1"></a>      <span class="at">threads =</span> <span class="fu">threading</span>(<span class="dv">3</span>),</span>
<span id="cb28-808"><a href="#cb28-808" aria-hidden="true" tabindex="-1"></a>      <span class="at">silent =</span> <span class="dv">0</span>,</span>
<span id="cb28-809"><a href="#cb28-809" aria-hidden="true" tabindex="-1"></a>      <span class="at">refresh =</span> <span class="dv">500</span>,</span>
<span id="cb28-810"><a href="#cb28-810" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb28-811"><a href="#cb28-811" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb28-812"><a href="#cb28-812" aria-hidden="true" tabindex="-1"></a>      <span class="at">warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb28-813"><a href="#cb28-813" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>)</span>
<span id="cb28-814"><a href="#cb28-814" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-815"><a href="#cb28-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-816"><a href="#cb28-816" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear</span></span>
<span id="cb28-817"><a href="#cb28-817" aria-hidden="true" tabindex="-1"></a>mod_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(Weight <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Length <span class="sc">+</span> Treatment)     <span class="co"># Run with Gaussian family </span></span>
<span id="cb28-818"><a href="#cb28-818" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-819"><a href="#cb28-819" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="at">class =</span> b, <span class="at">coef =</span> Intercept, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>)),       <span class="co"># Intercept</span></span>
<span id="cb28-820"><a href="#cb28-820" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="at">coef =</span> TreatmentNone, <span class="fu">normal</span>(<span class="dv">50</span>,<span class="dv">5</span>)),  <span class="co"># Difference between treatments</span></span>
<span id="cb28-821"><a href="#cb28-821" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">lb =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">ub =</span> <span class="sc">-</span><span class="dv">2</span>)      <span class="co"># Slope </span></span>
<span id="cb28-822"><a href="#cb28-822" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb28-823"><a href="#cb28-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-824"><a href="#cb28-824" aria-hidden="true" tabindex="-1"></a>nl_mod_1 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(mod_formula, <span class="st">"NL_mod_1"</span>, priors)</span>
<span id="cb28-825"><a href="#cb28-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-826"><a href="#cb28-826" aria-hidden="true" tabindex="-1"></a><span class="co"># Gompertz</span></span>
<span id="cb28-827"><a href="#cb28-827" aria-hidden="true" tabindex="-1"></a>mod_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(Weight <span class="sc">~</span> k <span class="sc">*</span> <span class="fu">exp</span>( <span class="sc">-</span><span class="fu">exp</span>( <span class="sc">-</span>(r <span class="sc">*</span> (Length <span class="sc">-</span> delay)))),</span>
<span id="cb28-828"><a href="#cb28-828" aria-hidden="true" tabindex="-1"></a>                  k <span class="sc">+</span> r <span class="sc">+</span> delay <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Treatment,</span>
<span id="cb28-829"><a href="#cb28-829" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nl =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-830"><a href="#cb28-830" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-831"><a href="#cb28-831" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"k"</span>,     <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">50</span>,<span class="dv">20</span>)),  <span class="co"># Max Weight </span></span>
<span id="cb28-832"><a href="#cb28-832" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"r"</span>,     <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.05</span>)), <span class="co"># Growth Rate</span></span>
<span id="cb28-833"><a href="#cb28-833" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"delay"</span>, <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">30</span>,<span class="dv">2</span>))    <span class="co"># Delay across the x-axis </span></span>
<span id="cb28-834"><a href="#cb28-834" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb28-835"><a href="#cb28-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-836"><a href="#cb28-836" aria-hidden="true" tabindex="-1"></a>nl_mod_2 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(mod_formula, <span class="st">"NL_mod_2"</span>, priors)</span>
<span id="cb28-837"><a href="#cb28-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-838"><a href="#cb28-838" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic</span></span>
<span id="cb28-839"><a href="#cb28-839" aria-hidden="true" tabindex="-1"></a>mod_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(Weight <span class="sc">~</span> M <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> (M <span class="sc">-</span> mu0) <span class="sc">/</span> mu0 <span class="sc">*</span> <span class="fu">exp</span>( <span class="sc">-</span>b <span class="sc">*</span> Length)),</span>
<span id="cb28-840"><a href="#cb28-840" aria-hidden="true" tabindex="-1"></a>                  mu0 <span class="sc">+</span> b <span class="sc">+</span> M <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Treatment,</span>
<span id="cb28-841"><a href="#cb28-841" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nl =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-842"><a href="#cb28-842" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-843"><a href="#cb28-843" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"mu0"</span>, <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.1</span>)),  <span class="co"># Weight at length zero</span></span>
<span id="cb28-844"><a href="#cb28-844" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"b"</span>,   <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.1</span>)),  <span class="co"># Growth rate</span></span>
<span id="cb28-845"><a href="#cb28-845" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"M"</span>,   <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">50</span>,<span class="dv">20</span>))   <span class="co"># Max Weight</span></span>
<span id="cb28-846"><a href="#cb28-846" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb28-847"><a href="#cb28-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-848"><a href="#cb28-848" aria-hidden="true" tabindex="-1"></a>nl_mod_3 <span class="ot">&lt;-</span> <span class="fu">fit_brm</span>(mod_formula, <span class="st">"NL_mod_3"</span>, priors)</span>
<span id="cb28-849"><a href="#cb28-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-850"><a href="#cb28-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-851"><a href="#cb28-851" aria-hidden="true" tabindex="-1"></a><span class="fu">### Output</span></span>
<span id="cb28-852"><a href="#cb28-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-855"><a href="#cb28-855" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-856"><a href="#cb28-856" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: model-output_3</span></span>
<span id="cb28-857"><a href="#cb28-857" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-858"><a href="#cb28-858" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb28-859"><a href="#cb28-859" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nl_mod_1)</span>
<span id="cb28-860"><a href="#cb28-860" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nl_mod_2)</span>
<span id="cb28-861"><a href="#cb28-861" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nl_mod_3)</span>
<span id="cb28-862"><a href="#cb28-862" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-863"><a href="#cb28-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-864"><a href="#cb28-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-865"><a href="#cb28-865" aria-hidden="true" tabindex="-1"></a><span class="fu">### Validation</span></span>
<span id="cb28-866"><a href="#cb28-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-869"><a href="#cb28-869" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-870"><a href="#cb28-870" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: validation_3</span></span>
<span id="cb28-871"><a href="#cb28-871" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-872"><a href="#cb28-872" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb28-873"><a href="#cb28-873" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-show: hold</span></span>
<span id="cb28-874"><a href="#cb28-874" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: false</span></span>
<span id="cb28-875"><a href="#cb28-875" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb28-876"><a href="#cb28-876" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 4</span></span>
<span id="cb28-877"><a href="#cb28-877" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 2</span></span>
<span id="cb28-878"><a href="#cb28-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-879"><a href="#cb28-879" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(nl_mod_1)</span>
<span id="cb28-880"><a href="#cb28-880" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(nl_mod_2)</span>
<span id="cb28-881"><a href="#cb28-881" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(nl_mod_3)</span>
<span id="cb28-882"><a href="#cb28-882" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-883"><a href="#cb28-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-884"><a href="#cb28-884" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot linear</span></span>
<span id="cb28-885"><a href="#cb28-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-886"><a href="#cb28-886" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb28-887"><a href="#cb28-887" aria-hidden="true" tabindex="-1"></a><span class="in">df %&gt;%</span></span>
<span id="cb28-888"><a href="#cb28-888" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Treatment) %&gt;%</span></span>
<span id="cb28-889"><a href="#cb28-889" aria-hidden="true" tabindex="-1"></a><span class="in">  data_grid(Length = seq_range(Length, n = 101)) %&gt;%</span></span>
<span id="cb28-890"><a href="#cb28-890" aria-hidden="true" tabindex="-1"></a><span class="in">  add_epred_draws(nl_mod_1, ndraws = 100) %&gt;%</span></span>
<span id="cb28-891"><a href="#cb28-891" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Length, y = Weight, color = Treatment)) +</span></span>
<span id="cb28-892"><a href="#cb28-892" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb28-893"><a href="#cb28-893" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = df, alpha = 0.25) +</span></span>
<span id="cb28-894"><a href="#cb28-894" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = .epred, group = paste(Treatment, .draw)), alpha = .1, color = "grey50") +</span></span>
<span id="cb28-895"><a href="#cb28-895" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(limits = c(0,90), breaks = seq(0,90,10)) +</span></span>
<span id="cb28-896"><a href="#cb28-896" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(limits = c(-100,100), breaks = seq(-100,100,10)) +</span></span>
<span id="cb28-897"><a href="#cb28-897" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~Treatment) +</span></span>
<span id="cb28-898"><a href="#cb28-898" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_brewer(palette = "Dark2")</span></span>
<span id="cb28-899"><a href="#cb28-899" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-900"><a href="#cb28-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-901"><a href="#cb28-901" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot Gompertz</span></span>
<span id="cb28-902"><a href="#cb28-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-903"><a href="#cb28-903" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb28-904"><a href="#cb28-904" aria-hidden="true" tabindex="-1"></a><span class="in">df %&gt;%</span></span>
<span id="cb28-905"><a href="#cb28-905" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Treatment) %&gt;%</span></span>
<span id="cb28-906"><a href="#cb28-906" aria-hidden="true" tabindex="-1"></a><span class="in">  data_grid(Length = seq_range(Length, n = 101)) %&gt;%</span></span>
<span id="cb28-907"><a href="#cb28-907" aria-hidden="true" tabindex="-1"></a><span class="in">  add_epred_draws(nl_mod_2, ndraws = 100) %&gt;%</span></span>
<span id="cb28-908"><a href="#cb28-908" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Length, y = Weight, color = Treatment)) +</span></span>
<span id="cb28-909"><a href="#cb28-909" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb28-910"><a href="#cb28-910" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = df, alpha = 0.25) +</span></span>
<span id="cb28-911"><a href="#cb28-911" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = .epred, group = paste(Treatment, .draw)), alpha = .1, color = "grey50") +</span></span>
<span id="cb28-912"><a href="#cb28-912" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(limits = c(0,90), breaks = seq(0,90,10)) +</span></span>
<span id="cb28-913"><a href="#cb28-913" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(limits = c(0,80), breaks = seq(0,80,10)) +</span></span>
<span id="cb28-914"><a href="#cb28-914" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~Treatment) +</span></span>
<span id="cb28-915"><a href="#cb28-915" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_brewer(palette = "Dark2")</span></span>
<span id="cb28-916"><a href="#cb28-916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-917"><a href="#cb28-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-918"><a href="#cb28-918" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot Logistic</span></span>
<span id="cb28-919"><a href="#cb28-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-920"><a href="#cb28-920" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb28-921"><a href="#cb28-921" aria-hidden="true" tabindex="-1"></a><span class="in">df %&gt;%</span></span>
<span id="cb28-922"><a href="#cb28-922" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Treatment) %&gt;%</span></span>
<span id="cb28-923"><a href="#cb28-923" aria-hidden="true" tabindex="-1"></a><span class="in">  data_grid(Length = seq_range(Length, n = 101)) %&gt;%</span></span>
<span id="cb28-924"><a href="#cb28-924" aria-hidden="true" tabindex="-1"></a><span class="in">  add_epred_draws(nl_mod_3, ndraws = 100) %&gt;%</span></span>
<span id="cb28-925"><a href="#cb28-925" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Length, y = Weight, color = Treatment)) +</span></span>
<span id="cb28-926"><a href="#cb28-926" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb28-927"><a href="#cb28-927" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = df, alpha = 0.25) +</span></span>
<span id="cb28-928"><a href="#cb28-928" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = .epred, group = paste(Treatment, .draw)), alpha = .1, color = "grey50") +</span></span>
<span id="cb28-929"><a href="#cb28-929" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(limits = c(0,90), breaks = seq(0,90,10)) +</span></span>
<span id="cb28-930"><a href="#cb28-930" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(limits = c(0,80), breaks = seq(0,80,10)) +</span></span>
<span id="cb28-931"><a href="#cb28-931" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~Treatment) +</span></span>
<span id="cb28-932"><a href="#cb28-932" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_brewer(palette = "Dark2")</span></span>
<span id="cb28-933"><a href="#cb28-933" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-934"><a href="#cb28-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-935"><a href="#cb28-935" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model comparison</span></span>
<span id="cb28-936"><a href="#cb28-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-939"><a href="#cb28-939" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-940"><a href="#cb28-940" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(nl_mod_1, nl_mod_2, nl_mod_3)</span>
<span id="cb28-941"><a href="#cb28-941" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-942"><a href="#cb28-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-943"><a href="#cb28-943" aria-hidden="true" tabindex="-1"></a><span class="fu">### Stan code</span></span>
<span id="cb28-944"><a href="#cb28-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-947"><a href="#cb28-947" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-948"><a href="#cb28-948" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: stan_3</span></span>
<span id="cb28-949"><a href="#cb28-949" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-950"><a href="#cb28-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-951"><a href="#cb28-951" aria-hidden="true" tabindex="-1"></a>mod_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(Weight <span class="sc">~</span> k <span class="sc">*</span> <span class="fu">exp</span>( <span class="sc">-</span><span class="fu">exp</span>( <span class="sc">-</span>(r <span class="sc">*</span> (Length <span class="sc">-</span> delay)))),</span>
<span id="cb28-952"><a href="#cb28-952" aria-hidden="true" tabindex="-1"></a>                  k <span class="sc">+</span> r <span class="sc">+</span> delay <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Treatment,</span>
<span id="cb28-953"><a href="#cb28-953" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nl =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-954"><a href="#cb28-954" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-955"><a href="#cb28-955" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"k"</span>,     <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">50</span>,<span class="dv">20</span>)),  <span class="co"># Max Weight </span></span>
<span id="cb28-956"><a href="#cb28-956" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"r"</span>,     <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.05</span>)), <span class="co"># Growth Rate</span></span>
<span id="cb28-957"><a href="#cb28-957" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="at">nlpar =</span> <span class="st">"delay"</span>, <span class="at">lb =</span> <span class="dv">0</span>, <span class="fu">normal</span>(<span class="dv">30</span>,<span class="dv">2</span>))    <span class="co"># Delay across the x-axis </span></span>
<span id="cb28-958"><a href="#cb28-958" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb28-959"><a href="#cb28-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-960"><a href="#cb28-960" aria-hidden="true" tabindex="-1"></a><span class="fu">make_stancode</span>(</span>
<span id="cb28-961"><a href="#cb28-961" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> mod_formula,</span>
<span id="cb28-962"><a href="#cb28-962" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df,</span>
<span id="cb28-963"><a href="#cb28-963" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> priors,</span>
<span id="cb28-964"><a href="#cb28-964" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">"identity"</span>)</span>
<span id="cb28-965"><a href="#cb28-965" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-966"><a href="#cb28-966" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-967"><a href="#cb28-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-968"><a href="#cb28-968" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb28-969"><a href="#cb28-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-970"><a href="#cb28-970" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb28-971"><a href="#cb28-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-972"><a href="#cb28-972" aria-hidden="true" tabindex="-1"></a>Models can be used to estimate parameters of interest that better capture data generating process based on ecological theory. </span>
<span id="cb28-973"><a href="#cb28-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-974"><a href="#cb28-974" aria-hidden="true" tabindex="-1"></a>Prior information can be useful in constraining models to realistic estimates.</span>
<span id="cb28-975"><a href="#cb28-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-976"><a href="#cb28-976" aria-hidden="true" tabindex="-1"></a>Here the Gompertz and logistic models estimated the growth rate to be 0.03 and 0.10 and maximum weight to be 115 (g) and 50.0 (g), respectively. </span>
<span id="cb28-977"><a href="#cb28-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-978"><a href="#cb28-978" aria-hidden="true" tabindex="-1"></a><span class="fu">### Food for thought: </span></span>
<span id="cb28-979"><a href="#cb28-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-980"><a href="#cb28-980" aria-hidden="true" tabindex="-1"></a>Which model is the best at capturing the data generating process?</span>
<span id="cb28-981"><a href="#cb28-981" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-982"><a href="#cb28-982" aria-hidden="true" tabindex="-1"></a>Could ecological theory informed techniques be applied to your own research? </span>
<span id="cb28-983"><a href="#cb28-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-984"><a href="#cb28-984" aria-hidden="true" tabindex="-1"></a><span class="fu"># Beyond brms: in space</span></span>
<span id="cb28-985"><a href="#cb28-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-986"><a href="#cb28-986" aria-hidden="true" tabindex="-1"></a>This section demonstrates the use of Stan to fit a choice model based on the hidden minds and observed behavior data example from McElreath (2020). The model estimates the probability of choosing a particular option based on the majority and minority choices, as well as the maverick and random choices.</span>
<span id="cb28-987"><a href="#cb28-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-988"><a href="#cb28-988" aria-hidden="true" tabindex="-1"></a>The five stratergies are: </span>
<span id="cb28-989"><a href="#cb28-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-990"><a href="#cb28-990" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Follow the Majority: Copy the majority demonstrated color.</span>
<span id="cb28-991"><a href="#cb28-991" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Follow the Minority: Copy the minority demonstrated color.</span>
<span id="cb28-992"><a href="#cb28-992" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Maverick: Choose the color that no demonstrator chose.</span>
<span id="cb28-993"><a href="#cb28-993" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Random: Choose a color at random, ignoring the demonstrators.</span>
<span id="cb28-994"><a href="#cb28-994" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Follow First: Copy the color that was demonstrated first. This was either the majority color (when majority_first equals 1) or the minority color (when 0). (p. 533)</span>
<span id="cb28-995"><a href="#cb28-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-996"><a href="#cb28-996" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb28-997"><a href="#cb28-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1000"><a href="#cb28-1000" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-1001"><a href="#cb28-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">CMDSTAN =</span> cmdstanr<span class="sc">::</span><span class="fu">set_cmdstan_path</span>(<span class="st">"/powerplant/workspace/hrltxm/workbench-k8s/stan/vanilla_stan/cmdstan-2.36.0"</span>))</span>
<span id="cb28-1002"><a href="#cb28-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1003"><a href="#cb28-1003" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Boxes, <span class="at">package =</span> <span class="st">"rethinking"</span>)</span>
<span id="cb28-1004"><a href="#cb28-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1005"><a href="#cb28-1005" aria-hidden="true" tabindex="-1"></a>df_ss <span class="ot">&lt;-</span> Boxes <span class="co"># hidden minds and observed behavior data example</span></span>
<span id="cb28-1006"><a href="#cb28-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1007"><a href="#cb28-1007" aria-hidden="true" tabindex="-1"></a><span class="co"># prep data </span></span>
<span id="cb28-1008"><a href="#cb28-1008" aria-hidden="true" tabindex="-1"></a>dat_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb28-1009"><a href="#cb28-1009" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">nrow</span>(df_ss),</span>
<span id="cb28-1010"><a href="#cb28-1010" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> df_ss<span class="sc">$</span>y,</span>
<span id="cb28-1011"><a href="#cb28-1011" aria-hidden="true" tabindex="-1"></a>  <span class="at">majority_first =</span> df_ss<span class="sc">$</span>majority_first)</span>
<span id="cb28-1012"><a href="#cb28-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1013"><a href="#cb28-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1014"><a href="#cb28-1014" aria-hidden="true" tabindex="-1"></a>choice_model_1 <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="fu">here</span>(<span class="st">"Scripts/choice_model_1.stan"</span>))</span>
<span id="cb28-1015"><a href="#cb28-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1016"><a href="#cb28-1016" aria-hidden="true" tabindex="-1"></a>choice_mod_1 <span class="ot">&lt;-</span></span>
<span id="cb28-1017"><a href="#cb28-1017" aria-hidden="true" tabindex="-1"></a>  rstan<span class="sc">::</span><span class="fu">stan</span>(<span class="at">model_code =</span> choice_model_1, </span>
<span id="cb28-1018"><a href="#cb28-1018" aria-hidden="true" tabindex="-1"></a>       <span class="at">data =</span> dat_list, </span>
<span id="cb28-1019"><a href="#cb28-1019" aria-hidden="true" tabindex="-1"></a>       <span class="at">chains =</span> <span class="dv">3</span>, <span class="at">cores =</span> <span class="dv">3</span>)</span>
<span id="cb28-1020"><a href="#cb28-1020" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-1021"><a href="#cb28-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1022"><a href="#cb28-1022" aria-hidden="true" tabindex="-1"></a><span class="fu">### Stan - Model</span></span>
<span id="cb28-1023"><a href="#cb28-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1026"><a href="#cb28-1026" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-1027"><a href="#cb28-1027" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb28-1028"><a href="#cb28-1028" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: asis</span></span>
<span id="cb28-1029"><a href="#cb28-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1030"><a href="#cb28-1030" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">readLines</span>(<span class="fu">here</span>(<span class="st">"Scripts/choice_model_1.stan"</span>)), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-1031"><a href="#cb28-1031" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-1032"><a href="#cb28-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1033"><a href="#cb28-1033" aria-hidden="true" tabindex="-1"></a><span class="fu">### Output</span></span>
<span id="cb28-1034"><a href="#cb28-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1037"><a href="#cb28-1037" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-1038"><a href="#cb28-1038" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: model_output_3</span></span>
<span id="cb28-1039"><a href="#cb28-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1040"><a href="#cb28-1040" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(choice_mod_1, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"p"</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb28-1041"><a href="#cb28-1041" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-1042"><a href="#cb28-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1043"><a href="#cb28-1043" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot</span></span>
<span id="cb28-1044"><a href="#cb28-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1047"><a href="#cb28-1047" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-1048"><a href="#cb28-1048" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot_3</span></span>
<span id="cb28-1049"><a href="#cb28-1049" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 3</span></span>
<span id="cb28-1050"><a href="#cb28-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1051"><a href="#cb28-1051" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Majority~(italic(s)[1])"</span>, </span>
<span id="cb28-1052"><a href="#cb28-1052" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Minority~(italic(s)[2])"</span>,</span>
<span id="cb28-1053"><a href="#cb28-1053" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Maverick~(italic(s)[3])"</span>, </span>
<span id="cb28-1054"><a href="#cb28-1054" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Random~(italic(s)[4])"</span>, </span>
<span id="cb28-1055"><a href="#cb28-1055" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Follow~First~(italic(s)[5])"</span>)</span>
<span id="cb28-1056"><a href="#cb28-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1057"><a href="#cb28-1057" aria-hidden="true" tabindex="-1"></a>rethinking<span class="sc">::</span><span class="fu">precis</span>(choice_mod_1, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-1058"><a href="#cb28-1058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-1059"><a href="#cb28-1059" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(label, <span class="at">levels =</span> label)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-1060"><a href="#cb28-1060" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">fct_rev</span>(name)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-1061"><a href="#cb28-1061" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-1062"><a href="#cb28-1062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">xmin =</span> X5.<span class="fl">5.</span>, <span class="at">xmax =</span> X94.<span class="fl">5.</span>, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb28-1063"><a href="#cb28-1063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb28-1064"><a href="#cb28-1064" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">2</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb28-1065"><a href="#cb28-1065" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">fatten =</span> <span class="dv">6</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb28-1066"><a href="#cb28-1066" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(p[s])), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb28-1067"><a href="#cb28-1067" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb28-1068"><a href="#cb28-1068" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> ggplot2<span class="sc">:::</span>parse_safe) <span class="sc">+</span></span>
<span id="cb28-1069"><a href="#cb28-1069" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span>
<span id="cb28-1070"><a href="#cb28-1070" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-1071"><a href="#cb28-1071" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb28-1072"><a href="#cb28-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1073"><a href="#cb28-1073" aria-hidden="true" tabindex="-1"></a><span class="fu"># References</span></span>
<span id="cb28-1074"><a href="#cb28-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1075"><a href="#cb28-1075" aria-hidden="true" tabindex="-1"></a>McElreath, R. (2020). Statistical rethinking: A Bayesian course with examples in R and Stan. Chapman and Hall/CRC.</span>
<span id="cb28-1076"><a href="#cb28-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1077"><a href="#cb28-1077" aria-hidden="true" tabindex="-1"></a>R Core Team (2022). R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. <span class="ot">&lt;https://www.R-project.org/&gt;</span></span>
<span id="cb28-1078"><a href="#cb28-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1079"><a href="#cb28-1079" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Session Information" collapse="true"}</span>
<span id="cb28-1082"><a href="#cb28-1082" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-1083"><a href="#cb28-1083" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: session-info</span></span>
<span id="cb28-1084"><a href="#cb28-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-1085"><a href="#cb28-1085" aria-hidden="true" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">sessionInfo</span>()</span>
<span id="cb28-1086"><a href="#cb28-1086" aria-hidden="true" tabindex="-1"></a><span class="in">```</span> </span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>